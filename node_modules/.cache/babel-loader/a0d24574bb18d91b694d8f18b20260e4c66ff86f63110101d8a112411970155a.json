{"ast":null,"code":"import _objectSpread from\"C:/Users/Baap/Desktop/campus-event-management/campus-event-frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{Container,Row,Col,Card,Badge,Button,Modal,Form,Tab,Tabs}from'react-bootstrap';import{Link}from'react-router-dom';import{toast}from'react-toastify';import axios from'../../utils/axios';import LoadingSpinner from'../../components/common/LoadingSpinner';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const MyRegistrationsPage=()=>{const[registrations,setRegistrations]=useState([]);const[loading,setLoading]=useState(true);const[showCancelModal,setShowCancelModal]=useState(false);const[registrationToCancel,setRegistrationToCancel]=useState(null);const[showFeedbackModal,setShowFeedbackModal]=useState(false);const[feedbackRegistration,setFeedbackRegistration]=useState(null);const[activeTab,setActiveTab]=useState('upcoming');const[feedbackData,setFeedbackData]=useState({rating:5,comment:'',wouldRecommend:true,categories:{content:5,organization:5,venue:5,overall:5}});useEffect(()=>{fetchRegistrations();},[]);const fetchRegistrations=async()=>{try{setLoading(true);const response=await axios.get('/api/registrations/my');setRegistrations(response.data.data.registrations||[]);}catch(error){console.error('Failed to fetch registrations:',error);toast.error('Failed to load registrations');}finally{setLoading(false);}};const handleCancelRegistration=async()=>{if(!registrationToCancel)return;try{await axios.delete(\"/api/registrations/\".concat(registrationToCancel._id));toast.success('Registration cancelled successfully');fetchRegistrations();setShowCancelModal(false);setRegistrationToCancel(null);}catch(error){console.error('Failed to cancel registration:',error);toast.error('Failed to cancel registration');}};const handleSubmitFeedback=async e=>{e.preventDefault();try{await axios.post(\"/api/registrations/\".concat(feedbackRegistration._id,\"/feedback\"),feedbackData);toast.success('Feedback submitted successfully');fetchRegistrations();setShowFeedbackModal(false);setFeedbackRegistration(null);setFeedbackData({rating:5,comment:'',wouldRecommend:true,categories:{content:5,organization:5,venue:5,overall:5}});}catch(error){console.error('Failed to submit feedback:',error);toast.error('Failed to submit feedback');}};const getStatusBadge=status=>{const variants={pending:'warning',confirmed:'success',waitlisted:'info',cancelled:'danger',attended:'primary','no-show':'secondary'};return/*#__PURE__*/_jsx(Badge,{bg:variants[status]||'secondary',children:status});};const formatDate=dateString=>{return new Date(dateString).toLocaleDateString('en-US',{year:'numeric',month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'});};const isEventPast=endDate=>{return new Date(endDate)<new Date();};const canCancelRegistration=registration=>{const event=registration.event;const now=new Date();const eventStart=new Date(event.startDate);return registration.status==='confirmed'&&eventStart>now;};const filterRegistrations=status=>{if(status==='upcoming'){return registrations.filter(reg=>!isEventPast(reg.event.endDate)&&['confirmed','pending','waitlisted'].includes(reg.status));}else if(status==='past'){return registrations.filter(reg=>isEventPast(reg.event.endDate)||['attended','no-show','cancelled'].includes(reg.status));}return registrations;};if(loading){return/*#__PURE__*/_jsx(LoadingSpinner,{});}const upcomingRegistrations=filterRegistrations('upcoming');const pastRegistrations=filterRegistrations('past');return/*#__PURE__*/_jsxs(Container,{className:\"py-4\",children:[/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(\"h1\",{className:\"mb-4\",children:\"My Event Registrations\"})})}),/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(Card.Body,{children:/*#__PURE__*/_jsxs(Tabs,{activeKey:activeTab,onSelect:k=>setActiveTab(k),className:\"mb-3\",children:[/*#__PURE__*/_jsx(Tab,{eventKey:\"upcoming\",title:\"Upcoming (\".concat(upcomingRegistrations.length,\")\"),children:upcomingRegistrations.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-5\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-calendar-check text-muted\",style:{fontSize:'3rem'}}),/*#__PURE__*/_jsx(\"h4\",{className:\"mt-3\",children:\"No Upcoming Events\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-muted\",children:\"You haven't registered for any upcoming events.\"}),/*#__PURE__*/_jsx(Link,{to:\"/events\",className:\"btn btn-primary\",children:\"Browse Events\"})]}):/*#__PURE__*/_jsx(Row,{children:upcomingRegistrations.map(registration=>{var _registration$event$v;return/*#__PURE__*/_jsx(Col,{md:6,lg:4,className:\"mb-4\",children:/*#__PURE__*/_jsx(Card,{className:\"h-100\",children:/*#__PURE__*/_jsxs(Card.Body,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-between align-items-start mb-2\",children:[/*#__PURE__*/_jsx(\"h6\",{className:\"card-title\",children:registration.event.title}),getStatusBadge(registration.status)]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-muted small mb-2\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-geo-alt me-1\"}),((_registration$event$v=registration.event.venue)===null||_registration$event$v===void 0?void 0:_registration$event$v.name)||'Venue TBA']}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-muted small mb-2\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-calendar me-1\"}),formatDate(registration.event.startDate)]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-muted small mb-3\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-clock me-1\"}),\"Registered: \",formatDate(registration.registrationDate)]}),registration.registrationNumber&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-muted small mb-3\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-hash me-1\"}),registration.registrationNumber]}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex gap-2\",children:[/*#__PURE__*/_jsx(Button,{as:Link,to:\"/events/\".concat(registration.event._id),variant:\"outline-primary\",size:\"sm\",children:\"View Event\"}),canCancelRegistration(registration)&&/*#__PURE__*/_jsx(Button,{variant:\"outline-danger\",size:\"sm\",onClick:()=>{setRegistrationToCancel(registration);setShowCancelModal(true);},children:\"Cancel\"})]})]})})},registration._id);})})}),/*#__PURE__*/_jsx(Tab,{eventKey:\"past\",title:\"Past (\".concat(pastRegistrations.length,\")\"),children:pastRegistrations.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-5\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-calendar-x text-muted\",style:{fontSize:'3rem'}}),/*#__PURE__*/_jsx(\"h4\",{className:\"mt-3\",children:\"No Past Events\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-muted\",children:\"You haven't attended any events yet.\"})]}):/*#__PURE__*/_jsx(Row,{children:pastRegistrations.map(registration=>{var _registration$event$v2,_registration$feedbac,_registration$feedbac2;return/*#__PURE__*/_jsx(Col,{md:6,lg:4,className:\"mb-4\",children:/*#__PURE__*/_jsx(Card,{className:\"h-100\",children:/*#__PURE__*/_jsxs(Card.Body,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-between align-items-start mb-2\",children:[/*#__PURE__*/_jsx(\"h6\",{className:\"card-title\",children:registration.event.title}),getStatusBadge(registration.status)]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-muted small mb-2\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-geo-alt me-1\"}),((_registration$event$v2=registration.event.venue)===null||_registration$event$v2===void 0?void 0:_registration$event$v2.name)||'Venue TBA']}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-muted small mb-2\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-calendar me-1\"}),formatDate(registration.event.startDate)]}),((_registration$feedbac=registration.feedback)===null||_registration$feedbac===void 0?void 0:_registration$feedbac.rating)&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-2\",children:[/*#__PURE__*/_jsx(\"small\",{className:\"text-muted\",children:\"Your Rating: \"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-warning\",children:['★'.repeat(registration.feedback.rating),'☆'.repeat(5-registration.feedback.rating)]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex gap-2\",children:[/*#__PURE__*/_jsx(Button,{as:Link,to:\"/events/\".concat(registration.event._id),variant:\"outline-primary\",size:\"sm\",children:\"View Event\"}),registration.status==='attended'&&!((_registration$feedbac2=registration.feedback)!==null&&_registration$feedbac2!==void 0&&_registration$feedbac2.rating)&&/*#__PURE__*/_jsx(Button,{variant:\"outline-success\",size:\"sm\",onClick:()=>{setFeedbackRegistration(registration);setShowFeedbackModal(true);},children:\"Leave Feedback\"})]})]})})},registration._id);})})})]})})})})}),/*#__PURE__*/_jsxs(Modal,{show:showCancelModal,onHide:()=>setShowCancelModal(false),children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,children:/*#__PURE__*/_jsx(Modal.Title,{children:\"Cancel Registration\"})}),/*#__PURE__*/_jsxs(Modal.Body,{children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"Are you sure you want to cancel your registration for \\\"\",registrationToCancel===null||registrationToCancel===void 0?void 0:registrationToCancel.event.title,\"\\\"?\"]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-warning\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Note:\"}),\" Depending on the event's cancellation policy, you may or may not receive a refund.\"]})]}),/*#__PURE__*/_jsxs(Modal.Footer,{children:[/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:()=>setShowCancelModal(false),children:\"Keep Registration\"}),/*#__PURE__*/_jsx(Button,{variant:\"danger\",onClick:handleCancelRegistration,children:\"Cancel Registration\"})]})]}),/*#__PURE__*/_jsxs(Modal,{show:showFeedbackModal,onHide:()=>setShowFeedbackModal(false),size:\"lg\",children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,children:/*#__PURE__*/_jsx(Modal.Title,{children:\"Event Feedback\"})}),/*#__PURE__*/_jsxs(Modal.Body,{children:[/*#__PURE__*/_jsx(\"h6\",{className:\"mb-3\",children:feedbackRegistration===null||feedbackRegistration===void 0?void 0:feedbackRegistration.event.title}),/*#__PURE__*/_jsxs(Form,{onSubmit:handleSubmitFeedback,children:[/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Overall Rating\"}),/*#__PURE__*/_jsxs(Form.Select,{value:feedbackData.rating,onChange:e=>setFeedbackData(_objectSpread(_objectSpread({},feedbackData),{},{rating:parseInt(e.target.value)})),children:[/*#__PURE__*/_jsx(\"option\",{value:5,children:\"5 - Excellent\"}),/*#__PURE__*/_jsx(\"option\",{value:4,children:\"4 - Very Good\"}),/*#__PURE__*/_jsx(\"option\",{value:3,children:\"3 - Good\"}),/*#__PURE__*/_jsx(\"option\",{value:2,children:\"2 - Fair\"}),/*#__PURE__*/_jsx(\"option\",{value:1,children:\"1 - Poor\"})]})]}),/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Comments\"}),/*#__PURE__*/_jsx(Form.Control,{as:\"textarea\",rows:4,value:feedbackData.comment,onChange:e=>setFeedbackData(_objectSpread(_objectSpread({},feedbackData),{},{comment:e.target.value})),placeholder:\"Share your thoughts about the event...\"})]}),/*#__PURE__*/_jsx(Form.Group,{className:\"mb-3\",children:/*#__PURE__*/_jsx(Form.Check,{type:\"checkbox\",id:\"would-recommend\",label:\"I would recommend this event to others\",checked:feedbackData.wouldRecommend,onChange:e=>setFeedbackData(_objectSpread(_objectSpread({},feedbackData),{},{wouldRecommend:e.target.checked}))})}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-end gap-2\",children:[/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:()=>setShowFeedbackModal(false),children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{type:\"submit\",variant:\"primary\",children:\"Submit Feedback\"})]})]})]})]})]});};export default MyRegistrationsPage;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}