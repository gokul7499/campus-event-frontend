{"ast":null,"code":"import _objectSpread from\"C:/Users/Baap/Desktop/campus-event-management/campus-event-frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{Row,Col,Card,Form,Button,Badge,Table,Modal,Spinner,Alert}from'react-bootstrap';import{toast}from'react-toastify';import axios from'../../utils/axios';import AdminLayout from'../../components/admin/AdminLayout';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const SendNotificationPage=()=>{const[users,setUsers]=useState([]);const[selectedUsers,setSelectedUsers]=useState([]);const[notificationData,setNotificationData]=useState({title:'',message:'',type:'general',priority:'normal',channels:{inApp:true,email:false,sms:false},scheduledFor:''});const[showPreview,setShowPreview]=useState(false);const[sending,setSending]=useState(false);useEffect(()=>{fetchUsers();},[]);const fetchUsers=async()=>{try{const response=await axios.get('/api/users?limit=100');setUsers(response.data.data||[]);}catch(error){console.error('Error fetching users:',error);toast.error('Failed to load users');}};const handleInputChange=(field,value)=>{if(field.includes('.')){const[parent,child]=field.split('.');setNotificationData(prev=>_objectSpread(_objectSpread({},prev),{},{[parent]:_objectSpread(_objectSpread({},prev[parent]),{},{[child]:value})}));}else{setNotificationData(prev=>_objectSpread(_objectSpread({},prev),{},{[field]:value}));}};const handleUserSelection=(userId,selected)=>{if(selected){setSelectedUsers(prev=>[...prev,userId]);}else{setSelectedUsers(prev=>prev.filter(id=>id!==userId));}};const handleSelectAll=selected=>{if(selected){setSelectedUsers(users.map(user=>user._id));}else{setSelectedUsers([]);}};const handleSendNotification=async()=>{if(!notificationData.title.trim()||!notificationData.message.trim()){toast.error('Please fill in title and message');return;}if(selectedUsers.length===0){toast.error('Please select at least one recipient');return;}try{setSending(true);// Transform channels from boolean to object format expected by backend\nconst transformedChannels={inApp:{enabled:notificationData.channels.inApp},email:{enabled:notificationData.channels.email},sms:{enabled:notificationData.channels.sms}};const payload=_objectSpread(_objectSpread({},notificationData),{},{channels:transformedChannels,recipients:selectedUsers,scheduledFor:notificationData.scheduledFor||undefined});console.log('=== SENDING NOTIFICATION ===');console.log('Payload:',payload);console.log('Channels:',transformedChannels);if(selectedUsers.length===1){await axios.post('/api/notifications/send',_objectSpread(_objectSpread({},payload),{},{recipientId:selectedUsers[0]}));}else{await axios.post('/api/notifications/send-bulk',_objectSpread(_objectSpread({},payload),{},{recipientIds:selectedUsers}));}toast.success(\"Notification sent to \".concat(selectedUsers.length,\" user(s)\"));// Reset form\nsetNotificationData({title:'',message:'',type:'general',priority:'normal',channels:{inApp:true,email:false,sms:false},scheduledFor:''});setSelectedUsers([]);setShowPreview(false);}catch(error){var _error$response,_error$response$data;console.error('Error sending notification:',error);toast.error(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||'Failed to send notification');}finally{setSending(false);}};const getSelectedUsersInfo=()=>{return users.filter(user=>selectedUsers.includes(user._id));};return/*#__PURE__*/_jsxs(AdminLayout,{children:[/*#__PURE__*/_jsx(Row,{className:\"mb-4\",children:/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-between align-items-center\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"mb-1\",children:\"Send Notification\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-muted mb-0\",children:\"Send notifications to users\"})]}),/*#__PURE__*/_jsxs(Button,{variant:\"primary\",onClick:()=>setShowPreview(true),disabled:!notificationData.title.trim()||!notificationData.message.trim()||selectedUsers.length===0,children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-eye me-2\"}),\"Preview & Send\"]})]})})}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsxs(Col,{lg:8,children:[/*#__PURE__*/_jsxs(Card,{className:\"mb-4 border-0 shadow-sm\",children:[/*#__PURE__*/_jsx(Card.Header,{className:\"bg-white border-0 py-3\",children:/*#__PURE__*/_jsx(\"h5\",{className:\"mb-0\",children:\"Notification Details\"})}),/*#__PURE__*/_jsxs(Card.Body,{children:[/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsxs(Col,{md:6,className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Title *\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",placeholder:\"Notification title\",value:notificationData.title,onChange:e=>handleInputChange('title',e.target.value),maxLength:200}),/*#__PURE__*/_jsxs(Form.Text,{className:\"text-muted\",children:[notificationData.title.length,\"/200 characters\"]})]}),/*#__PURE__*/_jsxs(Col,{md:6,className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Type\"}),/*#__PURE__*/_jsxs(Form.Select,{value:notificationData.type,onChange:e=>handleInputChange('type',e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"general\",children:\"General\"}),/*#__PURE__*/_jsx(\"option\",{value:\"system_announcement\",children:\"System Announcement\"}),/*#__PURE__*/_jsx(\"option\",{value:\"event_reminder\",children:\"Event Reminder\"}),/*#__PURE__*/_jsx(\"option\",{value:\"event_update\",children:\"Event Update\"})]})]}),/*#__PURE__*/_jsxs(Col,{md:12,className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Message *\"}),/*#__PURE__*/_jsx(Form.Control,{as:\"textarea\",rows:4,placeholder:\"Notification message\",value:notificationData.message,onChange:e=>handleInputChange('message',e.target.value),maxLength:1000}),/*#__PURE__*/_jsxs(Form.Text,{className:\"text-muted\",children:[notificationData.message.length,\"/1000 characters\"]})]}),/*#__PURE__*/_jsxs(Col,{md:6,className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Priority\"}),/*#__PURE__*/_jsxs(Form.Select,{value:notificationData.priority,onChange:e=>handleInputChange('priority',e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"low\",children:\"Low\"}),/*#__PURE__*/_jsx(\"option\",{value:\"normal\",children:\"Normal\"}),/*#__PURE__*/_jsx(\"option\",{value:\"high\",children:\"High\"}),/*#__PURE__*/_jsx(\"option\",{value:\"urgent\",children:\"Urgent\"})]})]}),/*#__PURE__*/_jsxs(Col,{md:6,className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Schedule For (Optional)\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"datetime-local\",value:notificationData.scheduledFor,onChange:e=>handleInputChange('scheduledFor',e.target.value),min:new Date().toISOString().slice(0,16)})]})]}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsx(\"h6\",{className:\"mb-3\",children:\"Delivery Channels\"}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:4,children:/*#__PURE__*/_jsx(Form.Check,{type:\"switch\",id:\"channel-inapp\",label:\"In-App Notification\",checked:notificationData.channels.inApp,onChange:e=>handleInputChange('channels.inApp',e.target.checked)})}),/*#__PURE__*/_jsx(Col,{md:4,children:/*#__PURE__*/_jsx(Form.Check,{type:\"switch\",id:\"channel-email\",label:\"Email Notification\",checked:notificationData.channels.email,onChange:e=>handleInputChange('channels.email',e.target.checked)})}),/*#__PURE__*/_jsxs(Col,{md:4,children:[/*#__PURE__*/_jsx(Form.Check,{type:\"switch\",id:\"channel-sms\",label:\"SMS Notification\",checked:notificationData.channels.sms,onChange:e=>handleInputChange('channels.sms',e.target.checked),disabled:true}),/*#__PURE__*/_jsx(Form.Text,{className:\"text-muted\",children:\"Coming soon\"})]})]})]})]}),/*#__PURE__*/_jsxs(Card,{className:\"border-0 shadow-sm\",children:[/*#__PURE__*/_jsxs(Card.Header,{className:\"bg-white border-0 py-3 d-flex justify-content-between align-items-center\",children:[/*#__PURE__*/_jsxs(\"h5\",{className:\"mb-0\",children:[\"Recipients (\",selectedUsers.length,\" selected)\"]}),/*#__PURE__*/_jsx(Form.Check,{type:\"switch\",id:\"select-all\",label:\"Select All\",checked:selectedUsers.length===users.length&&users.length>0,onChange:e=>handleSelectAll(e.target.checked)})]}),/*#__PURE__*/_jsx(Card.Body,{className:\"p-0\",children:/*#__PURE__*/_jsx(\"div\",{style:{maxHeight:'400px',overflowY:'auto'},children:/*#__PURE__*/_jsxs(Table,{responsive:true,hover:true,className:\"mb-0\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"table-light sticky-top\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{width:\"50\",children:\"Select\"}),/*#__PURE__*/_jsx(\"th\",{children:\"User\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Role\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Department\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:users.map(user=>{var _user$firstName,_user$lastName;return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(Form.Check,{type:\"checkbox\",checked:selectedUsers.includes(user._id),onChange:e=>handleUserSelection(user._id,e.target.checked)})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"avatar-sm bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center me-3\",children:/*#__PURE__*/_jsxs(\"span\",{className:\"text-primary fw-bold\",children:[(_user$firstName=user.firstName)===null||_user$firstName===void 0?void 0:_user$firstName.charAt(0),(_user$lastName=user.lastName)===null||_user$lastName===void 0?void 0:_user$lastName.charAt(0)]})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h6\",{className:\"mb-0\",children:[user.firstName,\" \",user.lastName]}),/*#__PURE__*/_jsx(\"small\",{className:\"text-muted\",children:user.email})]})]})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(Badge,{bg:user.role==='admin'?'danger':user.role==='organizer'?'warning':'info',children:user.role})}),/*#__PURE__*/_jsx(\"td\",{children:user.department||'N/A'})]},user._id);})})]})})})]})]}),/*#__PURE__*/_jsx(Col,{lg:4,children:/*#__PURE__*/_jsxs(Card,{className:\"border-0 shadow-sm sticky-top\",style:{top:'20px'},children:[/*#__PURE__*/_jsx(Card.Header,{className:\"bg-white border-0 py-3\",children:/*#__PURE__*/_jsx(\"h5\",{className:\"mb-0\",children:\"Preview\"})}),/*#__PURE__*/_jsxs(Card.Body,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"notification-preview border rounded p-3 mb-3\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-start\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0 me-3\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center\",style:{width:'40px',height:'40px'},children:/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-bell text-primary\"})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-grow-1\",children:[/*#__PURE__*/_jsx(\"h6\",{className:\"mb-1\",children:notificationData.title||'Notification Title'}),/*#__PURE__*/_jsx(\"p\",{className:\"mb-1 text-muted small\",children:notificationData.message||'Notification message will appear here...'}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center gap-2\",children:[/*#__PURE__*/_jsx(Badge,{bg:\"primary\",className:\"small\",children:notificationData.type.replace('_',' ')}),/*#__PURE__*/_jsx(Badge,{bg:notificationData.priority==='urgent'?'danger':notificationData.priority==='high'?'warning':notificationData.priority==='low'?'secondary':'info',className:\"small\",children:notificationData.priority})]})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(\"h6\",{children:\"Delivery Channels:\"}),/*#__PURE__*/_jsxs(\"ul\",{className:\"list-unstyled mb-0\",children:[notificationData.channels.inApp&&/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-app text-primary me-2\"}),\"In-App\"]}),notificationData.channels.email&&/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-envelope text-success me-2\"}),\"Email\"]}),notificationData.channels.sms&&/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-phone text-info me-2\"}),\"SMS\"]})]})]}),notificationData.scheduledFor&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3\",children:[/*#__PURE__*/_jsx(\"h6\",{children:\"Scheduled For:\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-muted small mb-0\",children:new Date(notificationData.scheduledFor).toLocaleString()})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h6\",{children:\"Recipients:\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-muted small mb-0\",children:[selectedUsers.length,\" user(s) selected\"]})]})]})]})})]}),/*#__PURE__*/_jsxs(Modal,{show:showPreview,onHide:()=>setShowPreview(false),size:\"lg\",children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,children:/*#__PURE__*/_jsx(Modal.Title,{children:\"Confirm Send Notification\"})}),/*#__PURE__*/_jsxs(Modal.Body,{children:[/*#__PURE__*/_jsxs(Alert,{variant:\"info\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-info-circle me-2\"}),\"You are about to send this notification to \",selectedUsers.length,\" user(s).\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"notification-preview border rounded p-3 mb-3\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-start\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0 me-3\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center\",style:{width:'40px',height:'40px'},children:/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-bell text-primary\"})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-grow-1\",children:[/*#__PURE__*/_jsx(\"h6\",{className:\"mb-1\",children:notificationData.title}),/*#__PURE__*/_jsx(\"p\",{className:\"mb-1 text-muted\",children:notificationData.message}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center gap-2\",children:[/*#__PURE__*/_jsx(Badge,{bg:\"primary\",className:\"small\",children:notificationData.type.replace('_',' ')}),/*#__PURE__*/_jsx(Badge,{bg:notificationData.priority==='urgent'?'danger':notificationData.priority==='high'?'warning':notificationData.priority==='low'?'secondary':'info',className:\"small\",children:notificationData.priority})]})]})]})}),/*#__PURE__*/_jsx(\"h6\",{children:\"Recipients:\"}),/*#__PURE__*/_jsx(\"div\",{style:{maxHeight:'200px',overflowY:'auto'},children:getSelectedUsersInfo().map(user=>{var _user$firstName2,_user$lastName2;return/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center mb-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"avatar-sm bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center me-3\",children:/*#__PURE__*/_jsxs(\"span\",{className:\"text-primary fw-bold\",children:[(_user$firstName2=user.firstName)===null||_user$firstName2===void 0?void 0:_user$firstName2.charAt(0),(_user$lastName2=user.lastName)===null||_user$lastName2===void 0?void 0:_user$lastName2.charAt(0)]})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h6\",{className:\"mb-0 small\",children:[user.firstName,\" \",user.lastName]}),/*#__PURE__*/_jsx(\"small\",{className:\"text-muted\",children:user.email})]})]},user._id);})})]}),/*#__PURE__*/_jsxs(Modal.Footer,{children:[/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:()=>setShowPreview(false),children:\"Cancel\"}),/*#__PURE__*/_jsxs(Button,{variant:\"primary\",onClick:handleSendNotification,disabled:sending,children:[sending?/*#__PURE__*/_jsx(Spinner,{size:\"sm\",className:\"me-2\"}):/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-send me-2\"}),\"Send Notification\"]})]})]})]});};export default SendNotificationPage;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}