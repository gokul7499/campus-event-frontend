{"ast":null,"code":"import _objectSpread from\"C:/Users/Baap/Desktop/campus-event-management/campus-event-frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{Container,Row,Col,Card,Form,Button,InputGroup}from'react-bootstrap';import{useNavigate}from'react-router-dom';import{toast}from'react-toastify';import axios from'../../utils/axios';import{useAuth}from'../../context/AuthContext';import LoadingSpinner from'../../components/common/LoadingSpinner';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const CreateEventPage=()=>{const navigate=useNavigate();const{user,hasRole,loading:authLoading}=useAuth();const[loading,setLoading]=useState(false);const[categories,setCategories]=useState([]);const[formData,setFormData]=useState({title:'',description:'',startDate:'',endDate:'',venue:{name:'',address:{street:'',city:'',state:'',zipCode:'',country:'USA'}},capacity:'',category:'',tags:[],registrationDeadline:'',isPublic:true,requiresApproval:false,isFeatured:false,price:{amount:0,currency:'USD',isFree:true},contact:{email:'',phone:'',website:''},requirements:{ageLimit:{min:'',max:''},prerequisites:[],equipment:[],documents:[]}});const[tagInput,setTagInput]=useState('');const[errors,setErrors]=useState({});// Check authentication and authorization\nuseEffect(()=>{if(!authLoading){if(!user){toast.error('Please log in to create events');navigate('/login');return;}if(!hasRole(['organizer','admin'])){toast.error('You need organizer or admin privileges to create events');navigate('/');return;}}},[user,authLoading,hasRole,navigate]);useEffect(()=>{if(user&&hasRole(['organizer','admin'])){fetchCategories();}},[user,hasRole]);const fetchCategories=async()=>{try{const response=await axios.get('/api/categories');console.log('Categories API response:',response.data);// Debug log\n// Handle different response structures\nlet categoriesData=[];if(response.data.success){// Check if data is directly an array or nested\nif(Array.isArray(response.data.data)){categoriesData=response.data.data;}else if(response.data.data&&Array.isArray(response.data.data.categories)){categoriesData=response.data.data.categories;}}console.log('Parsed categories:',categoriesData);// Debug log\nsetCategories(categoriesData);}catch(error){console.error('Failed to fetch categories:',error);toast.error('Failed to load categories');}};const handleInputChange=e=>{const{name,value,type,checked}=e.target;if(name.includes('.')){const keys=name.split('.');setFormData(prev=>{const newData=_objectSpread({},prev);let current=newData;for(let i=0;i<keys.length-1;i++){if(!current[keys[i]])current[keys[i]]={};current=current[keys[i]];}current[keys[keys.length-1]]=type==='checkbox'?checked:value;return newData;});}else{setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{[name]:type==='checkbox'?checked:value}));}};const handlePriceChange=e=>{const amount=parseFloat(e.target.value)||0;setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{price:_objectSpread(_objectSpread({},prev.price),{},{amount,isFree:amount===0})}));};const addTag=()=>{if(tagInput.trim()&&!formData.tags.includes(tagInput.trim())){setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{tags:[...prev.tags,tagInput.trim()]}));setTagInput('');}};const removeTag=tagToRemove=>{setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{tags:prev.tags.filter(tag=>tag!==tagToRemove)}));};const validateForm=()=>{const newErrors={};// Basic required fields\nif(!formData.title.trim())newErrors.title='Title is required';if(!formData.description.trim())newErrors.description='Description is required';if(!formData.startDate)newErrors.startDate='Start date is required';if(!formData.endDate)newErrors.endDate='End date is required';if(!formData.venue.name.trim())newErrors.venueName='Venue name is required';if(!formData.capacity||formData.capacity<1)newErrors.capacity='Valid capacity is required';if(!formData.category)newErrors.category='Category is required';// Title length validation\nif(formData.title.trim().length<3)newErrors.title='Title must be at least 3 characters';if(formData.title.trim().length>200)newErrors.title='Title cannot exceed 200 characters';// Description length validation\nif(formData.description.trim().length<10)newErrors.description='Description must be at least 10 characters';if(formData.description.trim().length>2000)newErrors.description='Description cannot exceed 2000 characters';// Capacity validation\nif(formData.capacity&&(formData.capacity<1||formData.capacity>10000)){newErrors.capacity='Capacity must be between 1 and 10000';}// Date validations\nif(formData.startDate&&formData.endDate){const startDate=new Date(formData.startDate);const endDate=new Date(formData.endDate);const now=new Date();if(startDate<=now){newErrors.startDate='Start date must be in the future';}if(endDate<=startDate){newErrors.endDate='End date must be after start date';}}if(formData.registrationDeadline&&formData.startDate){const regDeadline=new Date(formData.registrationDeadline);const startDate=new Date(formData.startDate);if(regDeadline>=startDate){newErrors.registrationDeadline='Registration deadline must be before event start';}}console.log('Validation errors:',newErrors);// Debug log\nsetErrors(newErrors);return Object.keys(newErrors).length===0;};const handleSubmit=async e=>{e.preventDefault();if(!validateForm()){toast.error('Please fix the errors in the form');return;}setLoading(true);try{// Prepare data for submission\nconst submitData=_objectSpread(_objectSpread({},formData),{},{// Ensure dates are in ISO format\nstartDate:new Date(formData.startDate).toISOString(),endDate:new Date(formData.endDate).toISOString(),registrationDeadline:formData.registrationDeadline?new Date(formData.registrationDeadline).toISOString():undefined,// Ensure capacity is a number\ncapacity:parseInt(formData.capacity),// Clean up empty fields\ncontact:{email:formData.contact.email||undefined,phone:formData.contact.phone||undefined,website:formData.contact.website||undefined}});// Remove undefined fields\nif(!submitData.registrationDeadline){delete submitData.registrationDeadline;}console.log('Submitting event data:',submitData);// Debug log\nconst response=await axios.post('/api/events',submitData);if(response.data.success){toast.success('Event created successfully!');navigate(\"/events/\".concat(response.data.data.event._id));}}catch(error){var _error$response,_error$response2,_error$response2$data;console.error('Failed to create event:',error);console.error('Error response:',(_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.data);// Debug log\ntoast.error(((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.message)||'Failed to create event');}finally{setLoading(false);}};if(loading||authLoading||categories.length===0&&user&&hasRole(['organizer','admin'])){return/*#__PURE__*/_jsx(LoadingSpinner,{});}// Don't render if user is not authenticated or authorized\nif(!user||!hasRole(['organizer','admin'])){return/*#__PURE__*/_jsx(LoadingSpinner,{});}return/*#__PURE__*/_jsxs(Container,{className:\"py-4\",children:[/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(\"h1\",{className:\"mb-4\",children:\"Create New Event\"})})}),/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(Col,{lg:8,className:\"mx-auto\",children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(Card.Body,{children:/*#__PURE__*/_jsxs(Form,{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"h5\",{className:\"mb-3\",children:\"Basic Information\"}),/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Event Title *\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",name:\"title\",value:formData.title,onChange:handleInputChange,isInvalid:!!errors.title,placeholder:\"Enter event title\",required:true}),/*#__PURE__*/_jsx(Form.Control.Feedback,{type:\"invalid\",children:errors.title})]}),/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Description *\"}),/*#__PURE__*/_jsx(Form.Control,{as:\"textarea\",rows:4,name:\"description\",value:formData.description,onChange:handleInputChange,isInvalid:!!errors.description,placeholder:\"Describe your event...\",required:true}),/*#__PURE__*/_jsx(Form.Control.Feedback,{type:\"invalid\",children:errors.description})]}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Category *\"}),/*#__PURE__*/_jsxs(Form.Select,{name:\"category\",value:formData.category,onChange:handleInputChange,isInvalid:!!errors.category,required:true,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select a category\"}),categories.map(category=>/*#__PURE__*/_jsx(\"option\",{value:category._id,children:category.name},category._id))]}),/*#__PURE__*/_jsx(Form.Control.Feedback,{type:\"invalid\",children:errors.category})]})}),/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Capacity *\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"number\",name:\"capacity\",value:formData.capacity,onChange:handleInputChange,isInvalid:!!errors.capacity,min:\"1\",max:\"10000\",placeholder:\"Maximum attendees\",required:true}),/*#__PURE__*/_jsx(Form.Control.Feedback,{type:\"invalid\",children:errors.capacity})]})})]}),/*#__PURE__*/_jsx(\"h5\",{className:\"mb-3 mt-4\",children:\"Date & Time\"}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Start Date & Time *\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"datetime-local\",name:\"startDate\",value:formData.startDate,onChange:handleInputChange,isInvalid:!!errors.startDate,required:true}),/*#__PURE__*/_jsx(Form.Control.Feedback,{type:\"invalid\",children:errors.startDate})]})}),/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"End Date & Time *\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"datetime-local\",name:\"endDate\",value:formData.endDate,onChange:handleInputChange,isInvalid:!!errors.endDate,required:true}),/*#__PURE__*/_jsx(Form.Control.Feedback,{type:\"invalid\",children:errors.endDate})]})})]}),/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Registration Deadline\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"datetime-local\",name:\"registrationDeadline\",value:formData.registrationDeadline,onChange:handleInputChange,isInvalid:!!errors.registrationDeadline}),/*#__PURE__*/_jsx(Form.Control.Feedback,{type:\"invalid\",children:errors.registrationDeadline}),/*#__PURE__*/_jsx(Form.Text,{className:\"text-muted\",children:\"Leave empty for no deadline\"})]}),/*#__PURE__*/_jsx(\"h5\",{className:\"mb-3 mt-4\",children:\"Venue Information\"}),/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Venue Name *\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",name:\"venue.name\",value:formData.venue.name,onChange:handleInputChange,isInvalid:!!errors.venueName,placeholder:\"Enter venue name\",required:true}),/*#__PURE__*/_jsx(Form.Control.Feedback,{type:\"invalid\",children:errors.venueName})]}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Street Address\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",name:\"venue.address.street\",value:formData.venue.address.street,onChange:handleInputChange,placeholder:\"Street address\"})]})}),/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"City\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",name:\"venue.address.city\",value:formData.venue.address.city,onChange:handleInputChange,placeholder:\"City\"})]})})]}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:4,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"State\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",name:\"venue.address.state\",value:formData.venue.address.state,onChange:handleInputChange,placeholder:\"State\"})]})}),/*#__PURE__*/_jsx(Col,{md:4,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"ZIP Code\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",name:\"venue.address.zipCode\",value:formData.venue.address.zipCode,onChange:handleInputChange,placeholder:\"ZIP Code\"})]})}),/*#__PURE__*/_jsx(Col,{md:4,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Country\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",name:\"venue.address.country\",value:formData.venue.address.country,onChange:handleInputChange,placeholder:\"Country\"})]})})]}),/*#__PURE__*/_jsx(\"h5\",{className:\"mb-3 mt-4\",children:\"Pricing\"}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Price (USD)\"}),/*#__PURE__*/_jsxs(InputGroup,{children:[/*#__PURE__*/_jsx(InputGroup.Text,{children:\"$\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"number\",step:\"0.01\",min:\"0\",value:formData.price.amount,onChange:handlePriceChange,placeholder:\"0.00\"})]}),/*#__PURE__*/_jsx(Form.Text,{className:\"text-muted\",children:\"Enter 0 for free events\"})]})}),/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Event Type\"}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-2\",children:/*#__PURE__*/_jsx(Form.Check,{type:\"switch\",id:\"is-free\",label:formData.price.isFree?\"Free Event\":\"Paid Event\",checked:formData.price.isFree,readOnly:true})})]})})]}),/*#__PURE__*/_jsx(\"h5\",{className:\"mb-3 mt-4\",children:\"Tags\"}),/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Add Tags\"}),/*#__PURE__*/_jsxs(InputGroup,{children:[/*#__PURE__*/_jsx(Form.Control,{type:\"text\",value:tagInput,onChange:e=>setTagInput(e.target.value),placeholder:\"Enter a tag\",onKeyPress:e=>{if(e.key==='Enter'){e.preventDefault();addTag();}}}),/*#__PURE__*/_jsx(Button,{variant:\"outline-secondary\",onClick:addTag,children:\"Add\"})]}),formData.tags.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-2\",children:formData.tags.map((tag,index)=>/*#__PURE__*/_jsxs(\"span\",{className:\"badge bg-primary me-2 mb-2\",children:[tag,/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn-close btn-close-white ms-2\",style:{fontSize:'0.7em'},onClick:()=>removeTag(tag)})]},index))})]}),/*#__PURE__*/_jsx(\"h5\",{className:\"mb-3 mt-4\",children:\"Contact Information\"}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Contact Email\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"email\",name:\"contact.email\",value:formData.contact.email,onChange:handleInputChange,placeholder:\"contact@example.com\"})]})}),/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Contact Phone\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"tel\",name:\"contact.phone\",value:formData.contact.phone,onChange:handleInputChange,placeholder:\"+1-555-0123\"})]})})]}),/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Website\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"url\",name:\"contact.website\",value:formData.contact.website,onChange:handleInputChange,placeholder:\"https://example.com\"})]}),/*#__PURE__*/_jsx(\"h5\",{className:\"mb-3 mt-4\",children:\"Event Settings\"}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:4,children:/*#__PURE__*/_jsx(Form.Check,{type:\"switch\",id:\"is-public\",label:\"Public Event\",name:\"isPublic\",checked:formData.isPublic,onChange:handleInputChange,className:\"mb-3\"})}),/*#__PURE__*/_jsx(Col,{md:4,children:/*#__PURE__*/_jsx(Form.Check,{type:\"switch\",id:\"requires-approval\",label:\"Requires Approval\",name:\"requiresApproval\",checked:formData.requiresApproval,onChange:handleInputChange,className:\"mb-3\"})}),/*#__PURE__*/_jsx(Col,{md:4,children:/*#__PURE__*/_jsx(Form.Check,{type:\"switch\",id:\"is-featured\",label:\"Featured Event\",name:\"isFeatured\",checked:formData.isFeatured,onChange:handleInputChange,className:\"mb-3\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-between mt-4\",children:[/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:()=>navigate('/dashboard'),children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{type:\"submit\",variant:\"primary\",disabled:loading,children:loading?'Creating Event...':'Create Event'})]})]})})})})})]});};export default CreateEventPage;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}