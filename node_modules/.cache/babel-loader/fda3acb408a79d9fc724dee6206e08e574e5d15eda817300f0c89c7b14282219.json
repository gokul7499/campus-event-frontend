{"ast":null,"code":"import _objectSpread from\"C:/Users/Baap/Desktop/campus-event-management/campus-event-frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useCallback}from'react';import{Container,Row,Col,Card,Button,Form,Badge,Pagination,Alert}from'react-bootstrap';import{Link}from'react-router-dom';import axios from'../../utils/axios';import LoadingSpinner from'../../components/common/LoadingSpinner';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const EventsPage=()=>{const[events,setEvents]=useState([]);const[categories,setCategories]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[filters,setFilters]=useState({search:'',category:'',startDate:'',endDate:'',sortBy:'startDate',sortOrder:'asc'});const[pagination,setPagination]=useState({currentPage:1,totalPages:1,totalItems:0,itemsPerPage:12});const fetchCategories=useCallback(async()=>{try{console.log('Fetching categories...');const response=await axios.get('/api/categories');console.log('Categories API Response:',response.data);setCategories(response.data.data||[]);}catch(error){console.error('Error fetching categories:',error);setCategories([]);// Set empty array on error\n}},[]);const fetchEvents=useCallback(async()=>{try{setLoading(true);const queryParams=new URLSearchParams();// Only add non-empty filter values\nif(filters.search.trim())queryParams.append('search',filters.search);if(filters.category)queryParams.append('category',filters.category);if(filters.startDate)queryParams.append('startDate',filters.startDate);if(filters.endDate)queryParams.append('endDate',filters.endDate);if(filters.sortBy)queryParams.append('sortBy',filters.sortBy);if(filters.sortOrder)queryParams.append('sortOrder',filters.sortOrder);queryParams.append('page',pagination.currentPage);queryParams.append('limit',pagination.itemsPerPage);console.log('Fetching events with URL:',\"/api/events?\".concat(queryParams));const response=await axios.get(\"/api/events?\".concat(queryParams));console.log('Events API Response:',response.data);setEvents(response.data.data||[]);setPagination(prev=>{var _response$data$pagina,_response$data$pagina2,_response$data$pagina3;return _objectSpread(_objectSpread({},prev),{},{currentPage:((_response$data$pagina=response.data.pagination)===null||_response$data$pagina===void 0?void 0:_response$data$pagina.currentPage)||1,totalPages:((_response$data$pagina2=response.data.pagination)===null||_response$data$pagina2===void 0?void 0:_response$data$pagina2.totalPages)||1,totalItems:((_response$data$pagina3=response.data.pagination)===null||_response$data$pagina3===void 0?void 0:_response$data$pagina3.totalItems)||0});});setError(null);// Clear any previous errors\n}catch(error){console.error('Error fetching events:',error);if(error.response){var _error$response$data;console.error('Response status:',error.response.status);console.error('Response data:',error.response.data);setError(\"Server error: \".concat(error.response.status,\" - \").concat(((_error$response$data=error.response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||'Unknown error'));}else if(error.request){setError('Cannot connect to server. Please check if the backend is running.');}else{setError(\"Request error: \".concat(error.message));}// Set empty state on error\nsetEvents([]);setPagination(prev=>_objectSpread(_objectSpread({},prev),{},{totalItems:0,totalPages:1}));}finally{setLoading(false);}},[filters,pagination.currentPage,pagination.itemsPerPage]);useEffect(()=>{fetchEvents();fetchCategories();},[fetchEvents,fetchCategories]);const handleFilterChange=e=>{const{name,value}=e.target;setFilters(prev=>_objectSpread(_objectSpread({},prev),{},{[name]:value}));setPagination(prev=>_objectSpread(_objectSpread({},prev),{},{currentPage:1}));};const handlePageChange=page=>{setPagination(prev=>_objectSpread(_objectSpread({},prev),{},{currentPage:page}));};const formatDate=dateString=>{return new Date(dateString).toLocaleDateString('en-US',{weekday:'short',year:'numeric',month:'short',day:'numeric'});};const formatTime=dateString=>{return new Date(dateString).toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit'});};if(loading&&events.length===0){return/*#__PURE__*/_jsx(LoadingSpinner,{fullScreen:true,text:\"Loading events...\"});}return/*#__PURE__*/_jsxs(Container,{className:\"py-4\",children:[/*#__PURE__*/_jsx(Row,{className:\"mb-4\",children:/*#__PURE__*/_jsxs(Col,{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"mb-3\",children:\"Campus Events\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-muted\",children:\"Discover and register for exciting events happening around campus\"})]})}),/*#__PURE__*/_jsx(Row,{className:\"mb-4\",children:/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(Card.Body,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:3,children:/*#__PURE__*/_jsxs(Form.Group,{children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Search Events\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",name:\"search\",value:filters.search,onChange:handleFilterChange,placeholder:\"Search by title, description...\"})]})}),/*#__PURE__*/_jsx(Col,{md:2,children:/*#__PURE__*/_jsxs(Form.Group,{children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Category\"}),/*#__PURE__*/_jsxs(Form.Select,{name:\"category\",value:filters.category,onChange:handleFilterChange,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"All Categories\"}),categories.map(category=>/*#__PURE__*/_jsx(\"option\",{value:category._id,children:category.name},category._id))]})]})}),/*#__PURE__*/_jsx(Col,{md:2,children:/*#__PURE__*/_jsxs(Form.Group,{children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Start Date\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"date\",name:\"startDate\",value:filters.startDate,onChange:handleFilterChange})]})}),/*#__PURE__*/_jsx(Col,{md:2,children:/*#__PURE__*/_jsxs(Form.Group,{children:[/*#__PURE__*/_jsx(Form.Label,{children:\"End Date\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"date\",name:\"endDate\",value:filters.endDate,onChange:handleFilterChange})]})}),/*#__PURE__*/_jsx(Col,{md:2,children:/*#__PURE__*/_jsxs(Form.Group,{children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Sort By\"}),/*#__PURE__*/_jsxs(Form.Select,{name:\"sortBy\",value:filters.sortBy,onChange:handleFilterChange,children:[/*#__PURE__*/_jsx(\"option\",{value:\"startDate\",children:\"Date\"}),/*#__PURE__*/_jsx(\"option\",{value:\"title\",children:\"Title\"}),/*#__PURE__*/_jsx(\"option\",{value:\"createdAt\",children:\"Recently Added\"})]})]})}),/*#__PURE__*/_jsx(Col,{md:1,children:/*#__PURE__*/_jsxs(Form.Group,{children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Order\"}),/*#__PURE__*/_jsxs(Form.Select,{name:\"sortOrder\",value:filters.sortOrder,onChange:handleFilterChange,children:[/*#__PURE__*/_jsx(\"option\",{value:\"asc\",children:\"Asc\"}),/*#__PURE__*/_jsx(\"option\",{value:\"desc\",children:\"Desc\"})]})]})})]})})})})}),error&&/*#__PURE__*/_jsx(Row,{className:\"mb-4\",children:/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsxs(Alert,{variant:\"danger\",dismissible:true,onClose:()=>setError(null),children:[/*#__PURE__*/_jsx(Alert.Heading,{children:\"Connection Error\"}),/*#__PURE__*/_jsx(\"p\",{children:error}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsx(\"div\",{className:\"d-flex justify-content-end\",children:/*#__PURE__*/_jsx(Button,{onClick:fetchEvents,variant:\"outline-danger\",children:\"Try Again\"})})]})})}),/*#__PURE__*/_jsx(Row,{className:\"mb-3\",children:/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsxs(\"p\",{className:\"text-muted\",children:[\"Showing \",events.length,\" of \",pagination.totalItems,\" events\"]})})}),loading?/*#__PURE__*/_jsx(LoadingSpinner,{text:\"Loading events...\"}):events.length===0?/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsxs(Col,{className:\"text-center py-5\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-calendar-x text-muted\",style:{fontSize:'3rem'}}),/*#__PURE__*/_jsx(\"h4\",{className:\"mt-3 text-muted\",children:\"No Events Found\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-muted mb-4\",children:error?'Unable to load events. Please check your connection and try again.':'Try adjusting your search criteria or check back later for new events.'}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-center gap-3\",children:[/*#__PURE__*/_jsxs(Button,{variant:\"primary\",onClick:fetchEvents,children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-arrow-clockwise me-2\"}),\"Refresh Events\"]}),(filters.search||filters.category||filters.startDate||filters.endDate)&&/*#__PURE__*/_jsx(Button,{variant:\"outline-secondary\",onClick:()=>{setFilters({search:'',category:'',startDate:'',endDate:'',sortBy:'startDate',sortOrder:'asc'});},children:\"Clear Filters\"})]})]})}):/*#__PURE__*/_jsx(Row,{children:events.map(event=>{var _event$images,_event$images$banner,_event$category;return/*#__PURE__*/_jsx(Col,{lg:4,md:6,className:\"mb-4\",children:/*#__PURE__*/_jsxs(Card,{className:\"h-100 event-card\",children:[((_event$images=event.images)===null||_event$images===void 0?void 0:(_event$images$banner=_event$images.banner)===null||_event$images$banner===void 0?void 0:_event$images$banner.medium)&&/*#__PURE__*/_jsx(Card.Img,{variant:\"top\",src:event.images.banner.medium,alt:event.title,className:\"event-image\"}),/*#__PURE__*/_jsxs(Card.Body,{className:\"d-flex flex-column\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-2\",children:[/*#__PURE__*/_jsx(Badge,{bg:\"primary\",className:\"me-2\",children:(_event$category=event.category)===null||_event$category===void 0?void 0:_event$category.name}),event.isFeatured&&/*#__PURE__*/_jsx(Badge,{bg:\"warning\",text:\"dark\",children:\"Featured\"})]}),/*#__PURE__*/_jsx(Card.Title,{className:\"h5\",children:event.title}),/*#__PURE__*/_jsxs(Card.Text,{className:\"text-muted flex-grow-1\",children:[event.description.substring(0,100),\"...\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"event-details mb-3\",children:[/*#__PURE__*/_jsxs(\"small\",{className:\"text-muted d-block\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-calendar me-1\"}),formatDate(event.startDate),\" at \",formatTime(event.startDate)]}),/*#__PURE__*/_jsxs(\"small\",{className:\"text-muted d-block\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-geo-alt me-1\"}),event.venue.name]}),/*#__PURE__*/_jsxs(\"small\",{className:\"text-muted d-block\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-people me-1\"}),event.availableSpots,\" spots available\"]})]}),/*#__PURE__*/_jsx(Button,{as:Link,to:\"/events/\".concat(event._id),variant:\"primary\",className:\"mt-auto\",children:\"View Details\"})]})]})},event._id);})}),pagination.totalPages>1&&/*#__PURE__*/_jsx(Row,{className:\"mt-4\",children:/*#__PURE__*/_jsx(Col,{className:\"d-flex justify-content-center\",children:/*#__PURE__*/_jsxs(Pagination,{children:[/*#__PURE__*/_jsx(Pagination.First,{onClick:()=>handlePageChange(1),disabled:pagination.currentPage===1}),/*#__PURE__*/_jsx(Pagination.Prev,{onClick:()=>handlePageChange(pagination.currentPage-1),disabled:pagination.currentPage===1}),[...Array(pagination.totalPages)].map((_,index)=>{const page=index+1;if(page===1||page===pagination.totalPages||page>=pagination.currentPage-2&&page<=pagination.currentPage+2){return/*#__PURE__*/_jsx(Pagination.Item,{active:page===pagination.currentPage,onClick:()=>handlePageChange(page),children:page},page);}else if(page===pagination.currentPage-3||page===pagination.currentPage+3){return/*#__PURE__*/_jsx(Pagination.Ellipsis,{},page);}return null;}),/*#__PURE__*/_jsx(Pagination.Next,{onClick:()=>handlePageChange(pagination.currentPage+1),disabled:pagination.currentPage===pagination.totalPages}),/*#__PURE__*/_jsx(Pagination.Last,{onClick:()=>handlePageChange(pagination.totalPages),disabled:pagination.currentPage===pagination.totalPages})]})})})]});};export default EventsPage;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}