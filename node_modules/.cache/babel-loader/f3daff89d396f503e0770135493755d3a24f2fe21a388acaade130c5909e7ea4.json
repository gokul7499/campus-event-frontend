{"ast":null,"code":"import _objectSpread from\"C:/Users/Baap/Desktop/campus-event-management/campus-event-frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{Container,Row,Col,Card,Table,Button,Modal,Form,Badge}from'react-bootstrap';import{toast}from'react-toastify';import axios from'../../utils/axios';import LoadingSpinner from'../../components/common/LoadingSpinner';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ManageCategoriesPage=()=>{const[categories,setCategories]=useState([]);const[loading,setLoading]=useState(true);const[showModal,setShowModal]=useState(false);const[editingCategory,setEditingCategory]=useState(null);const[showDeleteModal,setShowDeleteModal]=useState(false);const[categoryToDelete,setCategoryToDelete]=useState(null);const[formData,setFormData]=useState({name:'',description:'',color:'#007bff',icon:'calendar',isActive:true,sortOrder:0});useEffect(()=>{fetchCategories();},[]);const fetchCategories=async()=>{try{setLoading(true);const response=await axios.get('/api/categories');console.log('Categories API response:',response.data);// Debug log\n// Handle different response structures\nlet categoriesData=[];if(response.data.success){// Check if data is directly an array or nested\nif(Array.isArray(response.data.data)){categoriesData=response.data.data;}else if(response.data.data&&Array.isArray(response.data.data.categories)){categoriesData=response.data.data.categories;}}console.log('Parsed categories:',categoriesData);// Debug log\nsetCategories(categoriesData);}catch(error){console.error('Failed to fetch categories:',error);toast.error('Failed to load categories');}finally{setLoading(false);}};const handleSubmit=async e=>{e.preventDefault();try{if(editingCategory){await axios.put(\"/api/categories/\".concat(editingCategory._id),formData);toast.success('Category updated successfully');}else{await axios.post('/api/categories',formData);toast.success('Category created successfully');}fetchCategories();handleCloseModal();}catch(error){var _error$response,_error$response$data;console.error('Failed to save category:',error);toast.error(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||'Failed to save category');}};const handleEdit=category=>{setEditingCategory(category);setFormData({name:category.name,description:category.description||'',color:category.color,icon:category.icon,isActive:category.isActive,sortOrder:category.sortOrder});setShowModal(true);};const handleDelete=async()=>{if(!categoryToDelete)return;try{await axios.delete(\"/api/categories/\".concat(categoryToDelete._id));toast.success('Category deleted successfully');setCategories(categories.filter(cat=>cat._id!==categoryToDelete._id));setShowDeleteModal(false);setCategoryToDelete(null);}catch(error){var _error$response2,_error$response2$data;console.error('Failed to delete category:',error);toast.error(((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.message)||'Failed to delete category');}};const handleCloseModal=()=>{setShowModal(false);setEditingCategory(null);setFormData({name:'',description:'',color:'#007bff',icon:'calendar',isActive:true,sortOrder:0});};const toggleCategoryStatus=async(categoryId,currentStatus)=>{try{await axios.put(\"/api/categories/\".concat(categoryId),{isActive:!currentStatus});toast.success('Category status updated');fetchCategories();}catch(error){console.error('Failed to update category status:',error);toast.error('Failed to update category status');}};if(loading){return/*#__PURE__*/_jsx(LoadingSpinner,{});}return/*#__PURE__*/_jsxs(Container,{className:\"py-4\",children:[/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-between align-items-center mb-4\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Manage Categories\"}),/*#__PURE__*/_jsxs(Button,{variant:\"primary\",onClick:()=>setShowModal(true),children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-plus-circle me-2\"}),\"Add Category\"]})]})})}),/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(Card.Body,{children:categories.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-5\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-folder-x text-muted\",style:{fontSize:'3rem'}}),/*#__PURE__*/_jsx(\"h4\",{className:\"mt-3\",children:\"No Categories Found\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-muted\",children:\"Create your first category to get started.\"}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:()=>setShowModal(true),children:\"Create Category\"})]}):/*#__PURE__*/_jsxs(Table,{responsive:true,hover:true,children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Category\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Description\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Events\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Status\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Sort Order\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:categories.map(category=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"me-3 rounded\",style:{width:'20px',height:'20px',backgroundColor:category.color}}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h6\",{className:\"mb-0\",children:category.name}),/*#__PURE__*/_jsxs(\"small\",{className:\"text-muted\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-\".concat(category.icon,\" me-1\")}),category.slug]})]})]})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"span\",{className:\"text-muted\",children:category.description||'No description'})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(Badge,{bg:\"info\",children:[category.eventCount||0,\" events\"]})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(Badge,{bg:category.isActive?'success':'secondary',children:category.isActive?'Active':'Inactive'})}),/*#__PURE__*/_jsx(\"td\",{children:category.sortOrder}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex gap-2\",children:[/*#__PURE__*/_jsx(Button,{variant:\"outline-primary\",size:\"sm\",onClick:()=>handleEdit(category),children:/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-pencil\"})}),/*#__PURE__*/_jsx(Button,{variant:category.isActive?'outline-warning':'outline-success',size:\"sm\",onClick:()=>toggleCategoryStatus(category._id,category.isActive),children:/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-\".concat(category.isActive?'pause':'play')})}),/*#__PURE__*/_jsx(Button,{variant:\"outline-danger\",size:\"sm\",onClick:()=>{setCategoryToDelete(category);setShowDeleteModal(true);},disabled:category.eventCount>0,children:/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-trash\"})})]})})]},category._id))})]})})})})}),/*#__PURE__*/_jsxs(Modal,{show:showModal,onHide:handleCloseModal,size:\"lg\",children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,children:/*#__PURE__*/_jsx(Modal.Title,{children:editingCategory?'Edit Category':'Add New Category'})}),/*#__PURE__*/_jsx(Modal.Body,{children:/*#__PURE__*/_jsxs(Form,{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Category Name *\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",value:formData.name,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{name:e.target.value})),required:true,placeholder:\"Enter category name\"})]})}),/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Sort Order\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"number\",value:formData.sortOrder,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{sortOrder:parseInt(e.target.value)||0})),placeholder:\"0\"})]})})]}),/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Description\"}),/*#__PURE__*/_jsx(Form.Control,{as:\"textarea\",rows:3,value:formData.description,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{description:e.target.value})),placeholder:\"Enter category description\"})]}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Color\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"color\",value:formData.color,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{color:e.target.value}))})]})}),/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Icon\"}),/*#__PURE__*/_jsxs(Form.Select,{value:formData.icon,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{icon:e.target.value})),children:[/*#__PURE__*/_jsx(\"option\",{value:\"calendar\",children:\"Calendar\"}),/*#__PURE__*/_jsx(\"option\",{value:\"book\",children:\"Book\"}),/*#__PURE__*/_jsx(\"option\",{value:\"trophy\",children:\"Trophy\"}),/*#__PURE__*/_jsx(\"option\",{value:\"music-note\",children:\"Music Note\"}),/*#__PURE__*/_jsx(\"option\",{value:\"people\",children:\"People\"}),/*#__PURE__*/_jsx(\"option\",{value:\"palette\",children:\"Palette\"}),/*#__PURE__*/_jsx(\"option\",{value:\"briefcase\",children:\"Briefcase\"}),/*#__PURE__*/_jsx(\"option\",{value:\"heart\",children:\"Heart\"}),/*#__PURE__*/_jsx(\"option\",{value:\"tools\",children:\"Tools\"}),/*#__PURE__*/_jsx(\"option\",{value:\"code\",children:\"Code\"})]})]})})]}),/*#__PURE__*/_jsx(Form.Group,{className:\"mb-3\",children:/*#__PURE__*/_jsx(Form.Check,{type:\"switch\",id:\"is-active\",label:\"Active Category\",checked:formData.isActive,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{isActive:e.target.checked}))})}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-end gap-2\",children:[/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:handleCloseModal,children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{type:\"submit\",variant:\"primary\",children:editingCategory?'Update Category':'Create Category'})]})]})})]}),/*#__PURE__*/_jsxs(Modal,{show:showDeleteModal,onHide:()=>setShowDeleteModal(false),children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,children:/*#__PURE__*/_jsx(Modal.Title,{children:\"Confirm Delete\"})}),/*#__PURE__*/_jsxs(Modal.Body,{children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"Are you sure you want to delete the category \\\"\",categoryToDelete===null||categoryToDelete===void 0?void 0:categoryToDelete.name,\"\\\"?\"]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-danger\",children:/*#__PURE__*/_jsx(\"strong\",{children:\"This action cannot be undone.\"})})]}),/*#__PURE__*/_jsxs(Modal.Footer,{children:[/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:()=>setShowDeleteModal(false),children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{variant:\"danger\",onClick:handleDelete,children:\"Delete Category\"})]})]})]});};export default ManageCategoriesPage;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}