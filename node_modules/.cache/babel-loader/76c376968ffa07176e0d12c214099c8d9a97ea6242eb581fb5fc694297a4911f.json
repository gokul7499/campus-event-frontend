{"ast":null,"code":"import _objectSpread from\"C:/Users/Baap/Desktop/campus-event-management/campus-event-frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useCallback}from'react';import{Container,Row,Col,Card,Table,Button,Badge,Form,Modal,Dropdown}from'react-bootstrap';import{Link}from'react-router-dom';import{toast}from'react-toastify';import{useAuth}from'../../context/AuthContext';import axios from'../../utils/axios';import LoadingSpinner from'../../components/common/LoadingSpinner';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ManageEventsPage=()=>{const{user}=useAuth();const[events,setEvents]=useState([]);const[loading,setLoading]=useState(true);const[showDeleteModal,setShowDeleteModal]=useState(false);const[eventToDelete,setEventToDelete]=useState(null);const[filters,setFilters]=useState({status:'all',search:'',sortBy:'createdAt',sortOrder:'desc'});const fetchEvents=useCallback(async()=>{if(!user){console.log('User not loaded yet, skipping fetch');setLoading(false);return;}try{setLoading(true);const params=new URLSearchParams();if(filters.search)params.append('search',filters.search);if(filters.status!=='all')params.append('status',filters.status);params.append('sortBy',filters.sortBy);params.append('sortOrder',filters.sortOrder);console.log('=== FETCHING EVENTS ===');console.log('User role:',user.role);console.log('Filters:',filters);console.log('Params:',params.toString());let endpoint;if(user.role==='admin'){// Admin can see all events\nendpoint='/api/events';}else{// Organizers see only their events\nendpoint='/api/events/my/events';}console.log('Using endpoint:',endpoint);const response=await axios.get(\"\".concat(endpoint,\"?\").concat(params));console.log('=== API RESPONSE ===');console.log('Full response:',response.data);console.log('Response structure:',Object.keys(response.data));// Handle different response structures\nlet eventsData=[];if(response.data.data){if(Array.isArray(response.data.data)){// Direct array (from /api/events)\neventsData=response.data.data;}else if(response.data.data.events){// Nested events array (from /api/events/my/events)\neventsData=response.data.data.events;}else if(response.data.data.data){// Double nested (pagination response)\neventsData=response.data.data.data;}}console.log('Events extracted:',eventsData);console.log('Events count:',eventsData.length);setEvents(eventsData);}catch(error){var _error$response,_error$response2,_error$response3;console.error('=== ERROR FETCHING EVENTS ===');console.error('Error:',error);console.error('Error response:',(_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.data);console.error('Error status:',(_error$response2=error.response)===null||_error$response2===void 0?void 0:_error$response2.status);// If it's a 404 or network error, provide mock data for demo\nif(((_error$response3=error.response)===null||_error$response3===void 0?void 0:_error$response3.status)===404||!error.response){console.log('Providing mock data for demo...');const mockEvents=[{_id:'mock1',title:'Sample Tech Conference',description:'A sample technology conference for demonstration',startDate:new Date(Date.now()+7*24*60*60*1000),endDate:new Date(Date.now()+7*24*60*60*1000+8*60*60*1000),status:'published',venue:{name:'Convention Center'},capacity:500,registrationCount:25,waitlistCount:0,createdAt:new Date(),updatedAt:new Date()},{_id:'mock2',title:'Workshop: Digital Marketing',description:'Learn digital marketing strategies',startDate:new Date(Date.now()+14*24*60*60*1000),endDate:new Date(Date.now()+14*24*60*60*1000+4*60*60*1000),status:'draft',venue:{name:'Training Room A'},capacity:50,registrationCount:0,waitlistCount:0,createdAt:new Date(),updatedAt:new Date()}];setEvents(mockEvents);toast.info('Using demo data (backend not available)');}else{var _error$response4,_error$response4$data;toast.error(((_error$response4=error.response)===null||_error$response4===void 0?void 0:(_error$response4$data=_error$response4.data)===null||_error$response4$data===void 0?void 0:_error$response4$data.message)||'Failed to load events');setEvents([]);}}finally{setLoading(false);}},[user,filters]);useEffect(()=>{if(user){fetchEvents();}},[user,fetchEvents]);const handleDeleteEvent=async()=>{if(!eventToDelete)return;try{await axios.delete(\"/api/events/\".concat(eventToDelete._id));toast.success('Event deleted successfully');setEvents(events.filter(event=>event._id!==eventToDelete._id));setShowDeleteModal(false);setEventToDelete(null);}catch(error){console.error('Failed to delete event:',error);toast.error('Failed to delete event');}};const handleStatusChange=async(eventId,newStatus)=>{try{await axios.put(\"/api/events/\".concat(eventId),{status:newStatus});toast.success('Event status updated');fetchEvents();}catch(error){console.error('Failed to update event status:',error);toast.error('Failed to update event status');}};const getStatusBadge=status=>{const variants={draft:'secondary',published:'success',cancelled:'danger',completed:'info'};return/*#__PURE__*/_jsx(Badge,{bg:variants[status]||'secondary',children:status});};const formatDate=dateString=>{return new Date(dateString).toLocaleDateString('en-US',{year:'numeric',month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'});};if(loading){return/*#__PURE__*/_jsx(LoadingSpinner,{});}return/*#__PURE__*/_jsxs(Container,{className:\"py-4\",children:[/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-between align-items-center mb-4\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Manage Events\"}),/*#__PURE__*/_jsxs(Link,{to:\"/create-event\",className:\"btn btn-primary\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-plus-circle me-2\"}),\"Create New Event\"]})]})})}),/*#__PURE__*/_jsxs(Row,{className:\"mb-4\",children:[/*#__PURE__*/_jsx(Col,{md:3,children:/*#__PURE__*/_jsxs(Form.Group,{children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Status\"}),/*#__PURE__*/_jsxs(Form.Select,{value:filters.status,onChange:e=>setFilters(_objectSpread(_objectSpread({},filters),{},{status:e.target.value})),children:[/*#__PURE__*/_jsx(\"option\",{value:\"all\",children:\"All Events\"}),/*#__PURE__*/_jsx(\"option\",{value:\"draft\",children:\"Draft\"}),/*#__PURE__*/_jsx(\"option\",{value:\"published\",children:\"Published\"}),/*#__PURE__*/_jsx(\"option\",{value:\"cancelled\",children:\"Cancelled\"}),/*#__PURE__*/_jsx(\"option\",{value:\"completed\",children:\"Completed\"})]})]})}),/*#__PURE__*/_jsx(Col,{md:3,children:/*#__PURE__*/_jsxs(Form.Group,{children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Sort By\"}),/*#__PURE__*/_jsxs(Form.Select,{value:filters.sortBy,onChange:e=>setFilters(_objectSpread(_objectSpread({},filters),{},{sortBy:e.target.value})),children:[/*#__PURE__*/_jsx(\"option\",{value:\"createdAt\",children:\"Created Date\"}),/*#__PURE__*/_jsx(\"option\",{value:\"startDate\",children:\"Start Date\"}),/*#__PURE__*/_jsx(\"option\",{value:\"title\",children:\"Title\"}),/*#__PURE__*/_jsx(\"option\",{value:\"registrationCount\",children:\"Registrations\"})]})]})}),/*#__PURE__*/_jsx(Col,{md:3,children:/*#__PURE__*/_jsxs(Form.Group,{children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Order\"}),/*#__PURE__*/_jsxs(Form.Select,{value:filters.sortOrder,onChange:e=>setFilters(_objectSpread(_objectSpread({},filters),{},{sortOrder:e.target.value})),children:[/*#__PURE__*/_jsx(\"option\",{value:\"desc\",children:\"Descending\"}),/*#__PURE__*/_jsx(\"option\",{value:\"asc\",children:\"Ascending\"})]})]})}),/*#__PURE__*/_jsx(Col,{md:3,children:/*#__PURE__*/_jsxs(Form.Group,{children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Search\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",placeholder:\"Search events...\",value:filters.search,onChange:e=>setFilters(_objectSpread(_objectSpread({},filters),{},{search:e.target.value}))})]})})]}),/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(Card.Body,{children:events.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-5\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-calendar-x text-muted\",style:{fontSize:'3rem'}}),/*#__PURE__*/_jsx(\"h4\",{className:\"mt-3\",children:\"No Events Found\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-muted\",children:filters.search||filters.status!=='all'?'No events match your current filters.':'You haven\\'t created any events yet.'}),/*#__PURE__*/_jsx(Link,{to:\"/create-event\",className:\"btn btn-primary\",children:\"Create Your First Event\"})]}):/*#__PURE__*/_jsxs(Table,{responsive:true,hover:true,children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Event\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Date\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Status\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Registrations\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:events.map(event=>{var _event$venue;return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h6\",{className:\"mb-1\",children:event.title}),/*#__PURE__*/_jsx(\"small\",{className:\"text-muted\",children:((_event$venue=event.venue)===null||_event$venue===void 0?void 0:_event$venue.name)||'No venue specified'})]})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{children:formatDate(event.startDate)}),/*#__PURE__*/_jsxs(\"small\",{className:\"text-muted\",children:[\"to \",formatDate(event.endDate)]})]})}),/*#__PURE__*/_jsx(\"td\",{children:getStatusBadge(event.status)}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:event.registrationCount||0}),\" / \",event.capacity,event.waitlistCount>0&&/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"small\",{className:\"text-muted\",children:[\"+\",event.waitlistCount,\" waitlisted\"]})})]})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(Dropdown,{children:[/*#__PURE__*/_jsx(Dropdown.Toggle,{variant:\"outline-secondary\",size:\"sm\",children:\"Actions\"}),/*#__PURE__*/_jsxs(Dropdown.Menu,{children:[/*#__PURE__*/_jsxs(Dropdown.Item,{as:Link,to:\"/events/\".concat(event._id),children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-eye me-2\"}),\"View\"]}),/*#__PURE__*/_jsxs(Dropdown.Item,{as:Link,to:\"/edit-event/\".concat(event._id),children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-pencil me-2\"}),\"Edit\"]}),/*#__PURE__*/_jsxs(Dropdown.Item,{as:Link,to:\"/events/\".concat(event._id,\"/registrations\"),children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-people me-2\"}),\"Registrations\"]}),/*#__PURE__*/_jsx(Dropdown.Divider,{}),event.status==='draft'&&/*#__PURE__*/_jsxs(Dropdown.Item,{onClick:()=>handleStatusChange(event._id,'published'),children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-check-circle me-2\"}),\"Publish\"]}),event.status==='published'&&/*#__PURE__*/_jsxs(Dropdown.Item,{onClick:()=>handleStatusChange(event._id,'cancelled'),children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-x-circle me-2\"}),\"Cancel\"]}),/*#__PURE__*/_jsx(Dropdown.Divider,{}),/*#__PURE__*/_jsxs(Dropdown.Item,{className:\"text-danger\",onClick:()=>{setEventToDelete(event);setShowDeleteModal(true);},children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-trash me-2\"}),\"Delete\"]})]})]})})]},event._id);})})]})})})})}),/*#__PURE__*/_jsxs(Modal,{show:showDeleteModal,onHide:()=>setShowDeleteModal(false),children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,children:/*#__PURE__*/_jsx(Modal.Title,{children:\"Confirm Delete\"})}),/*#__PURE__*/_jsxs(Modal.Body,{children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"Are you sure you want to delete the event \\\"\",eventToDelete===null||eventToDelete===void 0?void 0:eventToDelete.title,\"\\\"?\"]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-danger\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"This action cannot be undone.\"}),\" All registrations and related data will be permanently deleted.\"]})]}),/*#__PURE__*/_jsxs(Modal.Footer,{children:[/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:()=>setShowDeleteModal(false),children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{variant:\"danger\",onClick:handleDeleteEvent,children:\"Delete Event\"})]})]})]});};export default ManageEventsPage;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}