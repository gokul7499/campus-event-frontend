{"ast":null,"code":"import _objectSpread from\"C:/Users/Baap/Desktop/campus-event-management/campus-event-frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useCallback}from'react';import{Row,Col,Card,Table,Button,Badge,Form,InputGroup,Modal,Spinner,Pagination,Dropdown}from'react-bootstrap';import{toast}from'react-toastify';import axios from'../../utils/axios';import{useAuth}from'../../context/AuthContext';import LoadingSpinner from'../../components/common/LoadingSpinner';import AdminLayout from'../../components/admin/AdminLayout';import ApiTest from'../../components/common/ApiTest';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const ManageUsersPage=()=>{const{user}=useAuth();const[users,setUsers]=useState([]);const[loading,setLoading]=useState(true);const[pagination,setPagination]=useState({page:1,limit:10,total:0,pages:0});const[filters,setFilters]=useState({search:'',role:'',department:'',isActive:''});const[showModal,setShowModal]=useState(false);const[selectedUser,setSelectedUser]=useState(null);const[modalType,setModalType]=useState('view');// 'view', 'edit', 'delete'\nconst fetchUsers=useCallback(async()=>{try{var _response$data$data;setLoading(true);// Clean filters - remove empty values\nconst cleanFilters=Object.fromEntries(Object.entries(filters).filter(_ref=>{let[_,value]=_ref;return value!=='';}));const params=new URLSearchParams(_objectSpread({page:pagination.page,limit:pagination.limit},cleanFilters));console.log('=== FETCHING USERS ===');console.log('Pagination state:',pagination);console.log('Filters state:',filters);console.log('Clean filters:',cleanFilters);console.log('Final params:',params.toString());console.log('Request URL:',\"/api/users?\".concat(params));const response=await axios.get(\"/api/users?\".concat(params));console.log('=== API RESPONSE ===');console.log('Full response:',response);console.log('Response data:',response.data);console.log('Users array:',response.data.data);console.log('Users count:',(_response$data$data=response.data.data)===null||_response$data$data===void 0?void 0:_response$data$data.length);console.log('Pagination info:',response.data.pagination);if(response.data.success&&response.data.data){var _response$data$pagina3,_response$data$pagina4;setUsers(response.data.data);setPagination(prev=>{var _response$data$pagina,_response$data$pagina2;return _objectSpread(_objectSpread({},prev),{},{total:((_response$data$pagina=response.data.pagination)===null||_response$data$pagina===void 0?void 0:_response$data$pagina.totalItems)||0,pages:((_response$data$pagina2=response.data.pagination)===null||_response$data$pagina2===void 0?void 0:_response$data$pagina2.totalPages)||1});});console.log('=== STATE UPDATED ===');console.log('Users set to:',response.data.data);console.log('Pagination updated:',{total:((_response$data$pagina3=response.data.pagination)===null||_response$data$pagina3===void 0?void 0:_response$data$pagina3.totalItems)||0,pages:((_response$data$pagina4=response.data.pagination)===null||_response$data$pagina4===void 0?void 0:_response$data$pagina4.totalPages)||1});}else{console.error('Invalid response structure:',response.data);setUsers([]);setPagination(prev=>_objectSpread(_objectSpread({},prev),{},{total:0,pages:1}));}}catch(error){var _error$response,_error$response2,_error$response3,_error$response3$data;console.error('=== ERROR FETCHING USERS ===');console.error('Error object:',error);console.error('Error response:',error.response);console.error('Error data:',(_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.data);console.error('Error status:',(_error$response2=error.response)===null||_error$response2===void 0?void 0:_error$response2.status);toast.error(((_error$response3=error.response)===null||_error$response3===void 0?void 0:(_error$response3$data=_error$response3.data)===null||_error$response3$data===void 0?void 0:_error$response3$data.message)||'Failed to fetch users');setUsers([]);setPagination(prev=>_objectSpread(_objectSpread({},prev),{},{total:0,pages:1}));}finally{setLoading(false);}},[filters,pagination]);useEffect(()=>{fetchUsers();},[fetchUsers]);const handleFilterChange=(field,value)=>{setFilters(prev=>_objectSpread(_objectSpread({},prev),{},{[field]:value}));setPagination(prev=>_objectSpread(_objectSpread({},prev),{},{page:1}));};const handlePageChange=page=>{setPagination(prev=>_objectSpread(_objectSpread({},prev),{},{page}));};const handleUserAction=(user,action)=>{setSelectedUser(user);setModalType(action);setShowModal(true);};const handleUpdateUser=async userData=>{try{await axios.put(\"/api/users/\".concat(selectedUser._id),userData);toast.success('User updated successfully');setShowModal(false);fetchUsers();}catch(error){var _error$response4,_error$response4$data;console.error('Error updating user:',error);toast.error(((_error$response4=error.response)===null||_error$response4===void 0?void 0:(_error$response4$data=_error$response4.data)===null||_error$response4$data===void 0?void 0:_error$response4$data.message)||'Failed to update user');}};const handleDeleteUser=async()=>{try{await axios.delete(\"/api/users/\".concat(selectedUser._id));toast.success('User deleted successfully');setShowModal(false);fetchUsers();}catch(error){var _error$response5,_error$response5$data;console.error('Error deleting user:',error);toast.error(((_error$response5=error.response)===null||_error$response5===void 0?void 0:(_error$response5$data=_error$response5.data)===null||_error$response5$data===void 0?void 0:_error$response5$data.message)||'Failed to delete user');}};const getRoleBadgeColor=role=>{switch(role){case'admin':return'danger';case'organizer':return'warning';case'participant':return'info';default:return'secondary';}};if(loading&&users.length===0){return/*#__PURE__*/_jsx(LoadingSpinner,{});}return/*#__PURE__*/_jsxs(AdminLayout,{children:[/*#__PURE__*/_jsx(ApiTest,{}),/*#__PURE__*/_jsx(Row,{className:\"mb-4\",children:/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-between align-items-center\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"mb-1\",children:\"Manage Users\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-muted mb-0\",children:\"Manage system users and their permissions\"})]}),/*#__PURE__*/_jsxs(Button,{variant:\"primary\",onClick:()=>handleUserAction(null,'create'),children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-plus-circle me-2\"}),\"Add User\"]})]})})}),/*#__PURE__*/_jsx(Row,{className:\"mb-4\",children:/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(Card,{className:\"border-0 shadow-sm\",children:/*#__PURE__*/_jsx(Card.Body,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsxs(Col,{lg:3,md:6,className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Search\"}),/*#__PURE__*/_jsxs(InputGroup,{children:[/*#__PURE__*/_jsx(InputGroup.Text,{children:/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-search\"})}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",placeholder:\"Search users...\",value:filters.search,onChange:e=>handleFilterChange('search',e.target.value)})]})]}),/*#__PURE__*/_jsxs(Col,{lg:2,md:6,className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Role\"}),/*#__PURE__*/_jsxs(Form.Select,{value:filters.role,onChange:e=>handleFilterChange('role',e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"All Roles\"}),/*#__PURE__*/_jsx(\"option\",{value:\"admin\",children:\"Admin\"}),/*#__PURE__*/_jsx(\"option\",{value:\"organizer\",children:\"Organizer\"}),/*#__PURE__*/_jsx(\"option\",{value:\"participant\",children:\"Participant\"})]})]}),/*#__PURE__*/_jsxs(Col,{lg:3,md:6,className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Department\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",placeholder:\"Department\",value:filters.department,onChange:e=>handleFilterChange('department',e.target.value)})]}),/*#__PURE__*/_jsxs(Col,{lg:2,md:6,className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Status\"}),/*#__PURE__*/_jsxs(Form.Select,{value:filters.isActive,onChange:e=>handleFilterChange('isActive',e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"All Status\"}),/*#__PURE__*/_jsx(\"option\",{value:\"true\",children:\"Active\"}),/*#__PURE__*/_jsx(\"option\",{value:\"false\",children:\"Inactive\"})]})]}),/*#__PURE__*/_jsxs(Col,{lg:2,md:12,className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"\\xA0\"}),/*#__PURE__*/_jsx(\"div\",{className:\"d-grid\",children:/*#__PURE__*/_jsx(Button,{variant:\"outline-secondary\",onClick:()=>{setFilters({search:'',role:'',department:'',isActive:''});setPagination(prev=>_objectSpread(_objectSpread({},prev),{},{page:1}));},children:\"Clear\"})})]})]})})})})}),/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsxs(Card,{className:\"border-0 shadow-sm\",children:[/*#__PURE__*/_jsxs(Card.Header,{className:\"bg-white border-0 py-3 d-flex justify-content-between align-items-center\",children:[/*#__PURE__*/_jsxs(\"h5\",{className:\"mb-0\",children:[\"Users (\",pagination.total,\")\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-muted me-3\",children:\"Show:\"}),/*#__PURE__*/_jsxs(Form.Select,{size:\"sm\",style:{width:'auto'},value:pagination.limit,onChange:e=>setPagination(prev=>_objectSpread(_objectSpread({},prev),{},{limit:parseInt(e.target.value),page:1})),children:[/*#__PURE__*/_jsx(\"option\",{value:10,children:\"10\"}),/*#__PURE__*/_jsx(\"option\",{value:25,children:\"25\"}),/*#__PURE__*/_jsx(\"option\",{value:50,children:\"50\"})]})]})]}),/*#__PURE__*/_jsx(Card.Body,{className:\"p-0\",children:loading?/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-4\",children:/*#__PURE__*/_jsx(Spinner,{animation:\"border\"})}):/*#__PURE__*/_jsxs(\"div\",{className:\"p-3 bg-light\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Debug Info:\"}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Users array length: \",users.length]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Users array: \",JSON.stringify(users.slice(0,2),null,2)]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Pagination total: \",pagination.total]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Loading: \",loading.toString()]})]})&&users.length>0?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Table,{responsive:true,hover:true,className:\"mb-0\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"table-light\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"User\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Role\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Department\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Events\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Status\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Joined\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:users.map(userItem=>{var _userItem$firstName,_userItem$lastName,_userItem$createdEven,_userItem$registeredE;return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"avatar-sm bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center me-3\",children:/*#__PURE__*/_jsxs(\"span\",{className:\"text-primary fw-bold\",children:[(_userItem$firstName=userItem.firstName)===null||_userItem$firstName===void 0?void 0:_userItem$firstName.charAt(0),(_userItem$lastName=userItem.lastName)===null||_userItem$lastName===void 0?void 0:_userItem$lastName.charAt(0)]})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h6\",{className:\"mb-0\",children:[userItem.firstName,\" \",userItem.lastName]}),/*#__PURE__*/_jsx(\"small\",{className:\"text-muted\",children:userItem.email})]})]})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(Badge,{bg:getRoleBadgeColor(userItem.role),children:userItem.role})}),/*#__PURE__*/_jsx(\"td\",{children:userItem.department||'N/A'}),/*#__PURE__*/_jsxs(\"td\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"fw-bold\",children:((_userItem$createdEven=userItem.createdEvents)===null||_userItem$createdEven===void 0?void 0:_userItem$createdEven.length)||0}),/*#__PURE__*/_jsx(\"small\",{className:\"text-muted\",children:\" created\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"span\",{className:\"fw-bold\",children:((_userItem$registeredE=userItem.registeredEvents)===null||_userItem$registeredE===void 0?void 0:_userItem$registeredE.length)||0}),/*#__PURE__*/_jsx(\"small\",{className:\"text-muted\",children:\" registered\"})]}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(Badge,{bg:userItem.isActive?'success':'danger',children:userItem.isActive?'Active':'Inactive'})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"small\",{className:\"text-muted\",children:new Date(userItem.createdAt).toLocaleDateString()})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(Dropdown,{children:[/*#__PURE__*/_jsx(Dropdown.Toggle,{variant:\"outline-secondary\",size:\"sm\",children:/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-three-dots\"})}),/*#__PURE__*/_jsxs(Dropdown.Menu,{children:[/*#__PURE__*/_jsxs(Dropdown.Item,{onClick:()=>handleUserAction(userItem,'view'),children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-eye me-2\"}),\"View\"]}),/*#__PURE__*/_jsxs(Dropdown.Item,{onClick:()=>handleUserAction(userItem,'edit'),children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-pencil me-2\"}),\"Edit\"]}),/*#__PURE__*/_jsx(Dropdown.Divider,{}),/*#__PURE__*/_jsxs(Dropdown.Item,{className:\"text-danger\",onClick:()=>handleUserAction(userItem,'delete'),disabled:userItem._id===user._id,children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-trash me-2\"}),\"Delete\"]})]})]})})]},userItem._id);})})]}),pagination.pages>1&&/*#__PURE__*/_jsx(\"div\",{className:\"d-flex justify-content-center py-3\",children:/*#__PURE__*/_jsxs(Pagination,{children:[/*#__PURE__*/_jsx(Pagination.Prev,{disabled:pagination.page===1,onClick:()=>handlePageChange(pagination.page-1)}),[...Array(pagination.pages)].map((_,index)=>/*#__PURE__*/_jsx(Pagination.Item,{active:pagination.page===index+1,onClick:()=>handlePageChange(index+1),children:index+1},index+1)),/*#__PURE__*/_jsx(Pagination.Next,{disabled:pagination.page===pagination.pages,onClick:()=>handlePageChange(pagination.page+1)})]})})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-5\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-people text-muted\",style:{fontSize:'3rem'}}),/*#__PURE__*/_jsx(\"h4\",{className:\"mt-3\",children:\"No Users Found\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-muted\",children:\"No users match your current filters.\"})]})})]})})}),/*#__PURE__*/_jsx(UserModal,{show:showModal,onHide:()=>setShowModal(false),user:selectedUser,type:modalType,onUpdate:handleUpdateUser,onDelete:handleDeleteUser})]});};// Placeholder for UserModal component\nconst UserModal=_ref2=>{let{show,onHide,user,type,onUpdate,onDelete}=_ref2;return/*#__PURE__*/_jsxs(Modal,{show:show,onHide:onHide,size:\"lg\",children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,children:/*#__PURE__*/_jsxs(Modal.Title,{children:[type==='view'&&'User Details',type==='edit'&&'Edit User',type==='create'&&'Create User',type==='delete'&&'Delete User']})}),/*#__PURE__*/_jsxs(Modal.Body,{children:[/*#__PURE__*/_jsx(\"p\",{children:\"User modal functionality will be implemented here.\"}),user&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Name:\"}),\" \",user.firstName,\" \",user.lastName]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Email:\"}),\" \",user.email]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Role:\"}),\" \",user.role]})]})]}),/*#__PURE__*/_jsxs(Modal.Footer,{children:[/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:onHide,children:\"Close\"}),type==='delete'&&/*#__PURE__*/_jsx(Button,{variant:\"danger\",onClick:onDelete,children:\"Delete User\"})]})]});};export default ManageUsersPage;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}