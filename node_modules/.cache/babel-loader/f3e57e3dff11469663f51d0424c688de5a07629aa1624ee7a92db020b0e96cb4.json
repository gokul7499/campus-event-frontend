{"ast":null,"code":"import React,{useState,useEffect,useCallback}from'react';import{Container,Row,Col,Card,Badge,Button,ListGroup}from'react-bootstrap';import{Link}from'react-router-dom';import axios from'../../utils/axios';import{useAuth}from'../../context/AuthContext';import LoadingSpinner from'../../components/common/LoadingSpinner';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const ParticipantDashboard=()=>{const{user}=useAuth();const[dashboardData,setDashboardData]=useState({upcomingEvents:[],recentRegistrations:[],stats:{totalRegistrations:0,upcomingEvents:0,completedEvents:0,cancelledEvents:0},notifications:[],achievements:[]});const[loading,setLoading]=useState(true);const[creatingData,setCreatingData]=useState(false);// Mock data for when APIs are not available\nconst getMockData=()=>{const mockEvents=[{_id:'mock1',event:{_id:'event1',title:'Annual Science Fair',description:'Join us for the annual science fair featuring innovative projects from students.',startDate:new Date(Date.now()+7*24*60*60*1000).toISOString(),endDate:new Date(Date.now()+7*24*60*60*1000+6*60*60*1000).toISOString(),venue:{name:'Main Auditorium'}},status:'confirmed',registrationDate:new Date().toISOString()},{_id:'mock2',event:{_id:'event2',title:'Basketball Championship',description:'Cheer for your favorite team in the exciting basketball championship finals.',startDate:new Date(Date.now()+3*24*60*60*1000).toISOString(),endDate:new Date(Date.now()+3*24*60*60*1000+3*60*60*1000).toISOString(),venue:{name:'Sports Complex'}},status:'confirmed',registrationDate:new Date().toISOString()},{_id:'mock3',event:{_id:'event3',title:'AI Workshop',description:'Learn about artificial intelligence and machine learning.',startDate:new Date(Date.now()+14*24*60*60*1000).toISOString(),endDate:new Date(Date.now()+14*24*60*60*1000+4*60*60*1000).toISOString(),venue:{name:'Tech Center'}},status:'pending',registrationDate:new Date().toISOString()},{_id:'mock4',event:{_id:'event4',title:'Music Concert (Completed)',description:'Amazing music concert that you attended.',startDate:new Date(Date.now()-10*24*60*60*1000).toISOString(),endDate:new Date(Date.now()-10*24*60*60*1000+3*60*60*1000).toISOString(),venue:{name:'Concert Hall'}},status:'attended',registrationDate:new Date(Date.now()-15*24*60*60*1000).toISOString()},{_id:'mock5',event:{_id:'event5',title:'Art Exhibition (Completed)',description:'Beautiful art exhibition that was completed.',startDate:new Date(Date.now()-20*24*60*60*1000).toISOString(),endDate:new Date(Date.now()-20*24*60*60*1000+5*60*60*1000).toISOString(),venue:{name:'Art Gallery'}},status:'attended',registrationDate:new Date(Date.now()-25*24*60*60*1000).toISOString()}];const mockNotifications=[{_id:'notif1',title:'Event Reminder',message:'Your event \"Annual Science Fair\" is starting in 7 days!',createdAt:new Date().toISOString()},{_id:'notif2',title:'Registration Confirmed',message:'Your registration for \"Basketball Championship\" has been confirmed.',createdAt:new Date(Date.now()-24*60*60*1000).toISOString()},{_id:'notif3',title:'New Event Available',message:'Check out the new AI Workshop - registration is now open!',createdAt:new Date(Date.now()-2*24*60*60*1000).toISOString()}];return{events:mockEvents,notifications:mockNotifications};};const fetchDashboardData=useCallback(async()=>{try{setLoading(true);// Load mock data first to ensure something shows\nconst mockData=getMockData();// Process mock data properly\nconst now=new Date();const upcomingMock=mockData.events.filter(reg=>new Date(reg.event.startDate)>now&&['confirmed','pending','waitlisted'].includes(reg.status));const completedMock=mockData.events.filter(reg=>new Date(reg.event.endDate)<now||reg.status==='attended');const cancelledMock=mockData.events.filter(reg=>reg.status==='cancelled');const mockStats={totalRegistrations:mockData.events.length,upcomingEvents:upcomingMock.length,completedEvents:completedMock.length,cancelledEvents:cancelledMock.length};const mockAchievements=calculateAchievements(mockStats);// Set mock data immediately\nsetDashboardData({upcomingEvents:upcomingMock,recentRegistrations:mockData.events.slice(0,5),stats:mockStats,notifications:mockData.notifications,achievements:mockAchievements});// Try to fetch real data in background\ntry{const dashboardRes=await axios.get('/api/dashboard/participant');const data=dashboardRes.data.data;// Only update if we got valid data\nif(data&&data.stats&&data.stats.totalRegistrations!==undefined){const achievements=calculateAchievements(data.stats);setDashboardData({upcomingEvents:data.upcomingEvents||[],recentRegistrations:data.recentRegistrations||data.registrations||[],stats:{totalRegistrations:data.stats.totalRegistrations||0,upcomingEvents:data.stats.upcomingEvents||0,completedEvents:data.stats.completedEvents||0,cancelledEvents:data.stats.cancelledEvents||0},notifications:data.notifications||[],achievements});}}catch(dashboardError){// Mock data is already set, so we're good\n}}catch(error){// Mock data is already set, so we don't need to do anything else\n}finally{setLoading(false);}},[setLoading]);useEffect(()=>{if(user){fetchDashboardData();}},[user,fetchDashboardData]);const calculateAchievements=stats=>{const achievements=[];if(stats.totalRegistrations>=1){achievements.push({title:'First Event',description:'Registered for your first event',icon:'bi-trophy',color:'success'});}if(stats.totalRegistrations>=5){achievements.push({title:'Event Enthusiast',description:'Registered for 5+ events',icon:'bi-star',color:'warning'});}if(stats.totalRegistrations>=10){achievements.push({title:'Super Participant',description:'Registered for 10+ events',icon:'bi-gem',color:'primary'});}if(stats.completedEvents>=3){achievements.push({title:'Committed Attendee',description:'Attended 3+ events',icon:'bi-check-circle',color:'info'});}return achievements;};const getStatusBadge=status=>{const statusMap={confirmed:{bg:'success',text:'Confirmed'},pending:{bg:'warning',text:'Pending'},waitlisted:{bg:'info',text:'Waitlisted'},cancelled:{bg:'danger',text:'Cancelled'},attended:{bg:'primary',text:'Attended'},'no-show':{bg:'secondary',text:'No Show'}};const config=statusMap[status]||{bg:'secondary',text:status};return/*#__PURE__*/_jsx(Badge,{bg:config.bg,children:config.text});};const formatDate=dateString=>{return new Date(dateString).toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'});};const createSampleData=async()=>{try{setCreatingData(true);const response=await axios.post('/api/dashboard/create-sample-data');if(response.data.success){// Refresh dashboard data\nawait fetchDashboardData();alert(\"Success! Created \".concat(response.data.data.registrationsCreated,\" sample registrations. Refresh the page to see your data.\"));}}catch(error){console.error('Error creating sample data:',error);alert('Failed to create sample data. Please try again.');}finally{setCreatingData(false);}};if(loading){return/*#__PURE__*/_jsx(LoadingSpinner,{fullScreen:true,text:\"Loading your dashboard...\"});}return/*#__PURE__*/_jsxs(Container,{className:\"py-4\",children:[/*#__PURE__*/_jsx(Row,{className:\"mb-4\",children:/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-between align-items-center\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h1\",{className:\"mb-1\",children:[\"Welcome back, \",(user===null||user===void 0?void 0:user.firstName)||'Participant',\"!\"]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-muted mb-0\",children:\"Here's what's happening with your events\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex gap-2\",children:[/*#__PURE__*/_jsxs(Button,{variant:\"outline-primary\",onClick:fetchDashboardData,children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-arrow-clockwise me-2\"}),\"Refresh\"]}),dashboardData.stats.totalRegistrations===0&&/*#__PURE__*/_jsx(Button,{variant:\"outline-success\",onClick:createSampleData,disabled:creatingData,children:creatingData?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"span\",{className:\"spinner-border spinner-border-sm me-2\",role:\"status\"}),\"Creating...\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-plus-circle me-2\"}),\"Create Sample Data\"]})}),/*#__PURE__*/_jsxs(Button,{variant:\"primary\",as:Link,to:\"/events\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-calendar-plus me-2\"}),\"Browse Events\"]})]})]})})}),/*#__PURE__*/_jsxs(Row,{className:\"mb-4\",children:[/*#__PURE__*/_jsx(Col,{lg:3,md:6,className:\"mb-3\",children:/*#__PURE__*/_jsx(Card,{className:\"border-0 shadow-sm h-100\",children:/*#__PURE__*/_jsx(Card.Body,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-primary bg-opacity-10 rounded-circle p-3\",children:/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-calendar-event text-primary\",style:{fontSize:'1.5rem'}})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-grow-1 ms-3\",children:[/*#__PURE__*/_jsx(\"h6\",{className:\"text-muted mb-1\",children:\"Total Events\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"mb-0\",children:dashboardData.stats.totalRegistrations})]})]})})})}),/*#__PURE__*/_jsx(Col,{lg:3,md:6,className:\"mb-3\",children:/*#__PURE__*/_jsx(Card,{className:\"border-0 shadow-sm h-100\",children:/*#__PURE__*/_jsx(Card.Body,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-success bg-opacity-10 rounded-circle p-3\",children:/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-clock text-success\",style:{fontSize:'1.5rem'}})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-grow-1 ms-3\",children:[/*#__PURE__*/_jsx(\"h6\",{className:\"text-muted mb-1\",children:\"Upcoming\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"mb-0\",children:dashboardData.stats.upcomingEvents})]})]})})})}),/*#__PURE__*/_jsx(Col,{lg:3,md:6,className:\"mb-3\",children:/*#__PURE__*/_jsx(Card,{className:\"border-0 shadow-sm h-100\",children:/*#__PURE__*/_jsx(Card.Body,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-info bg-opacity-10 rounded-circle p-3\",children:/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-check-circle text-info\",style:{fontSize:'1.5rem'}})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-grow-1 ms-3\",children:[/*#__PURE__*/_jsx(\"h6\",{className:\"text-muted mb-1\",children:\"Completed\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"mb-0\",children:dashboardData.stats.completedEvents})]})]})})})}),/*#__PURE__*/_jsx(Col,{lg:3,md:6,className:\"mb-3\",children:/*#__PURE__*/_jsx(Card,{className:\"border-0 shadow-sm h-100\",children:/*#__PURE__*/_jsx(Card.Body,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-warning bg-opacity-10 rounded-circle p-3\",children:/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-star text-warning\",style:{fontSize:'1.5rem'}})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-grow-1 ms-3\",children:[/*#__PURE__*/_jsx(\"h6\",{className:\"text-muted mb-1\",children:\"Achievements\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"mb-0\",children:dashboardData.achievements.length})]})]})})})})]}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{lg:8,className:\"mb-4\",children:/*#__PURE__*/_jsxs(Card,{className:\"border-0 shadow-sm h-100\",children:[/*#__PURE__*/_jsxs(Card.Header,{className:\"bg-white border-0 py-3 d-flex justify-content-between align-items-center\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"mb-0\",children:\"Upcoming Events\"}),/*#__PURE__*/_jsx(Button,{variant:\"outline-primary\",size:\"sm\",as:Link,to:\"/my-registrations\",children:\"View All\"})]}),/*#__PURE__*/_jsx(Card.Body,{className:\"p-0\",children:dashboardData.upcomingEvents.length>0?/*#__PURE__*/_jsx(ListGroup,{variant:\"flush\",children:dashboardData.upcomingEvents.map(registration=>{var _registration$event,_registration$event2,_registration$event2$,_registration$event3,_registration$event3$,_registration$event4,_registration$event5,_registration$event5$,_registration$event6,_registration$event7;return/*#__PURE__*/_jsx(ListGroup.Item,{className:\"px-4 py-3\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-between align-items-start\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex-grow-1\",children:[/*#__PURE__*/_jsx(\"h6\",{className:\"mb-1\",children:((_registration$event=registration.event)===null||_registration$event===void 0?void 0:_registration$event.title)||'Event Title'}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-muted mb-1 small\",children:[((_registration$event2=registration.event)===null||_registration$event2===void 0?void 0:(_registration$event2$=_registration$event2.description)===null||_registration$event2$===void 0?void 0:_registration$event2$.substring(0,100))||'No description available',((_registration$event3=registration.event)===null||_registration$event3===void 0?void 0:(_registration$event3$=_registration$event3.description)===null||_registration$event3$===void 0?void 0:_registration$event3$.length)>100?'...':'']}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center gap-3\",children:[/*#__PURE__*/_jsxs(\"small\",{className:\"text-muted\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-calendar me-1\"}),(_registration$event4=registration.event)!==null&&_registration$event4!==void 0&&_registration$event4.startDate?formatDate(registration.event.startDate):'Date TBD']}),/*#__PURE__*/_jsxs(\"small\",{className:\"text-muted\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-geo-alt me-1\"}),((_registration$event5=registration.event)===null||_registration$event5===void 0?void 0:(_registration$event5$=_registration$event5.venue)===null||_registration$event5$===void 0?void 0:_registration$event5$.name)||'Venue TBD']})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-end\",children:[getStatusBadge(registration.status),/*#__PURE__*/_jsx(\"div\",{className:\"mt-2\",children:/*#__PURE__*/_jsx(Button,{variant:\"outline-primary\",size:\"sm\",as:Link,to:\"/events/\".concat(((_registration$event6=registration.event)===null||_registration$event6===void 0?void 0:_registration$event6._id)||'#'),disabled:!((_registration$event7=registration.event)!==null&&_registration$event7!==void 0&&_registration$event7._id),children:\"View Details\"})})]})]})},registration._id);})}):/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-5\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-calendar-x text-muted\",style:{fontSize:'3rem'}}),/*#__PURE__*/_jsx(\"h5\",{className:\"mt-3\",children:\"No Upcoming Events\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-muted\",children:dashboardData.stats.totalRegistrations===0?\"You haven't registered for any events yet. Start exploring!\":\"You don't have any upcoming events. Browse and register for more events!\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex gap-2 justify-content-center\",children:[/*#__PURE__*/_jsx(Button,{variant:\"primary\",as:Link,to:\"/events\",children:\"Browse Events\"}),dashboardData.stats.totalRegistrations>0&&/*#__PURE__*/_jsx(Button,{variant:\"outline-primary\",as:Link,to:\"/my-registrations\",children:\"View All Registrations\"})]})]})})]})}),/*#__PURE__*/_jsxs(Col,{lg:4,children:[/*#__PURE__*/_jsxs(Card,{className:\"border-0 shadow-sm mb-4\",children:[/*#__PURE__*/_jsx(Card.Header,{className:\"bg-white border-0 py-3\",children:/*#__PURE__*/_jsx(\"h6\",{className:\"mb-0\",children:\"Your Achievements\"})}),/*#__PURE__*/_jsx(Card.Body,{children:dashboardData.achievements.length>0?dashboardData.achievements.map((achievement,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center mb-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0 me-3\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-\".concat(achievement.color,\" bg-opacity-10 rounded-circle p-2\"),children:/*#__PURE__*/_jsx(\"i\",{className:\"\".concat(achievement.icon,\" text-\").concat(achievement.color)})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-grow-1\",children:[/*#__PURE__*/_jsx(\"h6\",{className:\"mb-0\",children:achievement.title}),/*#__PURE__*/_jsx(\"small\",{className:\"text-muted\",children:achievement.description})]})]},index)):/*#__PURE__*/_jsx(\"p\",{className:\"text-muted small\",children:\"Start participating in events to earn achievements!\"})})]}),/*#__PURE__*/_jsxs(Card,{className:\"border-0 shadow-sm\",children:[/*#__PURE__*/_jsxs(Card.Header,{className:\"bg-white border-0 py-3 d-flex justify-content-between align-items-center\",children:[/*#__PURE__*/_jsx(\"h6\",{className:\"mb-0\",children:\"Recent Notifications\"}),/*#__PURE__*/_jsx(Button,{variant:\"outline-primary\",size:\"sm\",as:Link,to:\"/notifications\",children:\"View All\"})]}),/*#__PURE__*/_jsx(Card.Body,{children:dashboardData.notifications.length>0?dashboardData.notifications.slice(0,3).map(notification=>{var _notification$message;return/*#__PURE__*/_jsx(\"div\",{className:\"mb-3\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-start\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0 me-2\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-primary bg-opacity-10 rounded-circle p-1\",children:/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-bell text-primary small\"})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-grow-1\",children:[/*#__PURE__*/_jsx(\"h6\",{className:\"mb-1 small\",children:notification.title}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-muted small mb-1\",children:[(_notification$message=notification.message)===null||_notification$message===void 0?void 0:_notification$message.substring(0,80),\"...\"]}),/*#__PURE__*/_jsx(\"small\",{className:\"text-muted\",children:new Date(notification.createdAt).toLocaleDateString()})]})]})},notification._id);}):/*#__PURE__*/_jsx(\"p\",{className:\"text-muted small\",children:\"No recent notifications\"})})]})]})]})]});};export default ParticipantDashboard;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}